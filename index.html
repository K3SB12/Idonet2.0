<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Idonet 2.0 - Sistema de Gesti√≥n Educativa Completo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #1a5f7a;
            --secondary: #57c5b6;
            --accent: #159895;
            --danger: #e74c3c;
            --warning: #f39c12;
            --success: #27ae60;
            --bg: #f0f4f8;
            --card: #ffffff;
            --text: #2c3e50;
            --border: #e1e8ed;
        }

        body {
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, #0d3b4c 100%);
            color: white;
            padding: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.5rem;
            font-weight: 700;
            cursor: pointer;
        }

        .logo-icon {
            width: 45px;
            height: 45px;
            background: var(--secondary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .nav {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: rgba(255,255,255,0.15);
            border: none;
            color: white;
            padding: 0.6rem 1.2rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .nav-btn:hover, .nav-btn.active {
            background: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(87, 197, 182, 0.4);
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .notification-bell {
            position: relative;
            cursor: pointer;
            font-size: 1.4rem;
            padding: 0.5rem;
            border-radius: 50%;
            transition: background 0.3s;
        }

        .notification-bell:hover {
            background: rgba(255,255,255,0.2);
        }

        .notification-badge {
            position: absolute;
            top: 0;
            right: 0;
            background: var(--danger);
            color: white;
            font-size: 0.7rem;
            padding: 0.15rem 0.4rem;
            border-radius: 50%;
            font-weight: bold;
            min-width: 18px;
            text-align: center;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: var(--secondary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            cursor: pointer;
        }

        /* Main Container */
        .main-container {
            margin-top: 90px;
            padding: 2rem;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
            padding-bottom: 100px;
        }

        /* Cards */
        .card {
            background: var(--card);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 1.5rem;
            transition: all 0.3s;
            border: 1px solid transparent;
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .card-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--primary);
        }

        /* Grid Systems */
        .grid {
            display: grid;
            gap: 1.5rem;
        }

        .grid-2 { grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); }
        .grid-3 { grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
        .grid-4 { grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.95rem;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--secondary);
            color: white;
        }

        .btn-primary:hover {
            background: #45b5a6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(87, 197, 182, 0.4);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--border);
            color: var(--text);
        }

        .btn-outline:hover {
            border-color: var(--secondary);
            color: var(--secondary);
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Forms */
        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text);
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
            background: white;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(87, 197, 182, 0.1);
        }

        select.form-control {
            cursor: pointer;
        }

        textarea.form-control {
            resize: vertical;
            min-height: 100px;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            border-radius: 12px;
            border: 1px solid var(--border);
            background: white;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95rem;
        }

        th {
            background: var(--primary);
            color: white;
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            position: sticky;
            top: 0;
            white-space: nowrap;
        }

        td {
            padding: 0.875rem 1rem;
            border-bottom: 1px solid var(--border);
        }

        tr:hover {
            background: #f8f9fa;
        }

        tr.selected {
            background: #e3f2fd;
        }

        /* Stats Cards */
        .stat-card {
            background: linear-gradient(135deg, var(--card) 0%, #f8f9fa 100%);
            border-left: 4px solid var(--secondary);
            padding: 1.5rem;
            border-radius: 12px;
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--primary);
            line-height: 1.2;
        }

        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
            margin-top: 0.25rem;
        }

        /* Subject Cards (Dashboard) */
        .subject-card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: all 0.3s;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .subject-card:hover {
            border-color: var(--secondary);
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(0,0,0,0.15);
        }

        .subject-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--secondary), var(--accent));
        }

        .subject-header {
            margin-bottom: 1rem;
        }

        .subject-name {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.25rem;
        }

        .subject-meta {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .period-section {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
        }

        .period-title {
            font-weight: 600;
            color: var(--text);
            margin-bottom: 0.75rem;
            font-size: 0.9rem;
        }

        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .action-btn {
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
        }

        .action-btn:hover {
            transform: scale(1.05);
        }

        .btn-tc { background: #e3f2fd; color: #1976d2; }
        .btn-tareas { background: #f3e5f5; color: #7b1fa2; }
        .btn-pruebas { background: #e8f5e9; color: #388e3c; }
        .btn-asistencia { background: #fff3e0; color: #f57c00; }
        .btn-proyecto { background: #fce4ec; color: #c2185b; }
        .btn-reporte { background: #ffebee; color: #d32f2f; }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
            padding: 1rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            width: 100%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-lg {
            max-width: 900px;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #f8f9fa 0%, white 100%);
            border-radius: 20px 20px 0 0;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            background: #f8f9fa;
            border-radius: 0 0 20px 20px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: #6c757d;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s;
        }

        .close-btn:hover {
            background: #f0f0f0;
            color: var(--danger);
        }

        /* Attendance System */
        .attendance-calendar {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }

        .calendar-day {
            min-width: 80px;
            padding: 0.75rem;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid var(--border);
            background: white;
        }

        .calendar-day:hover {
            border-color: var(--secondary);
        }

        .calendar-day.active {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }

        .calendar-day.has-attendance {
            border-color: var(--success);
            position: relative;
        }

        .calendar-day.has-attendance::after {
            content: '‚úì';
            position: absolute;
            top: 2px;
            right: 2px;
            background: var(--success);
            color: white;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calendar-day.missing {
            border-color: var(--danger);
            opacity: 0.6;
        }

        .calendar-day-name {
            font-size: 0.75rem;
            text-transform: uppercase;
            font-weight: 600;
        }

        .calendar-day-number {
            font-size: 1.25rem;
            font-weight: 700;
            margin: 0.25rem 0;
        }

        .lesson-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .lesson-card {
            border-radius: 16px;
            padding: 1.25rem;
            color: white;
            position: relative;
            transition: all 0.3s;
            cursor: pointer;
        }

        .lesson-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
        }

        .lesson-card.registered {
            background: linear-gradient(135deg, #1a5f7a 0%, #2c8da8 100%);
        }

        .lesson-card.available {
            background: linear-gradient(135deg, #57c5b6 0%, #159895 100%);
        }

        .lesson-card.selected {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            box-shadow: 0 0 0 4px rgba(243, 156, 18, 0.3);
        }

        .lesson-number {
            font-size: 0.875rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }

        .lesson-subject {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .lesson-section {
            font-size: 0.875rem;
            opacity: 0.9;
        }

        .lesson-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .lesson-btn {
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            font-size: 0.8rem;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }

        .lesson-btn-edit {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .lesson-btn-delete {
            background: rgba(231, 76, 60, 0.8);
            color: white;
        }

        .attendance-list {
            margin-top: 1.5rem;
        }

        .attendance-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: var(--bg);
            border-radius: 12px;
            margin-bottom: 0.75rem;
            transition: all 0.2s;
        }

        .attendance-item:hover {
            background: #e9ecef;
            transform: translateX(4px);
        }

        .attendance-student {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .student-avatar {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, var(--secondary), var(--accent));
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .attendance-status {
            display: flex;
            gap: 0.5rem;
        }

        .status-btn {
            padding: 0.6rem 1.2rem;
            border: 2px solid var(--border);
            background: white;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-btn:hover {
            transform: scale(1.05);
        }

        .status-btn.active.present {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }

        .status-btn.active.absent-j {
            background: var(--warning);
            color: white;
            border-color: var(--warning);
        }

        .status-btn.active.absent-i {
            background: var(--danger);
            color: white;
            border-color: var(--danger);
        }

        .status-btn.active.late {
            background: #9b59b6;
            color: white;
            border-color: #9b59b6;
        }

        /* Schedule Grid */
        .schedule-container {
            overflow-x: auto;
        }

        .schedule-grid {
            display: grid;
            grid-template-columns: 100px repeat(5, 1fr);
            gap: 1px;
            background: var(--border);
            border-radius: 12px;
            overflow: hidden;
            min-width: 800px;
        }

        .schedule-cell {
            background: white;
            padding: 0.75rem;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .schedule-cell.header {
            background: var(--primary);
            color: white;
            font-weight: 600;
            text-align: center;
            min-height: auto;
            justify-content: center;
        }

        .schedule-cell.time-header {
            background: #f8f9fa;
            font-weight: 600;
            color: var(--text);
            justify-content: center;
            align-items: center;
        }

        .schedule-select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 0.85rem;
            background: white;
            cursor: pointer;
        }

        .schedule-select:focus {
            outline: none;
            border-color: var(--secondary);
        }

        .schedule-lesson {
            background: linear-gradient(135deg, var(--secondary), var(--accent));
            color: white;
            padding: 0.5rem;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .schedule-lesson:hover {
            transform: scale(1.05);
        }

        /* Indicators System */
        .indicator-panel {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
        }

        .indicator-item {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            border-left: 4px solid var(--secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .indicator-name {
            font-weight: 600;
            color: var(--text);
        }

        .indicator-points {
            font-size: 0.875rem;
            color: #6c757d;
        }

        .score-input {
            width: 70px;
            padding: 0.5rem;
            border: 2px solid var(--border);
            border-radius: 6px;
            text-align: center;
            font-weight: 600;
            transition: all 0.2s;
        }

        .score-input:focus {
            outline: none;
            border-color: var(--secondary);
        }

        .score-input.saved {
            border-color: var(--success);
            background: #e8f5e9;
        }

        /* ACS Section */
        .acs-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid var(--border);
        }

        .acs-tab {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #6c757d;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .acs-tab.active {
            color: var(--secondary);
            border-bottom-color: var(--secondary);
        }

        .acs-content {
            display: none;
        }

        .acs-content.active {
            display: block;
        }

        /* Reports */
        .report-config {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .config-section {
            margin-bottom: 1.5rem;
        }

        .config-title {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.75rem;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem;
            border-radius: 6px;
            transition: background 0.2s;
        }

        .checkbox-item:hover {
            background: white;
        }

        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .report-preview {
            background: white;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 2rem;
            min-height: 600px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
        }

        .report-header {
            text-align: center;
            border-bottom: 3px double var(--primary);
            padding-bottom: 1.5rem;
            margin-bottom: 2rem;
        }

        .report-logo {
            width: 100px;
            height: 100px;
            margin: 0 auto 1rem;
            background: var(--bg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 3000;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .toast {
            background: white;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 1rem;
            animation: slideIn 0.3s ease;
            border-left: 4px solid var(--success);
            max-width: 400px;
        }

        .toast.error {
            border-left-color: var(--danger);
        }

        .toast.warning {
            border-left-color: var(--warning);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: #6c757d;
        }

        .empty-state-icon {
            font-size: 5rem;
            margin-bottom: 1.5rem;
            opacity: 0.5;
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 0.35rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        /* Search Box */
        .search-box {
            position: relative;
            max-width: 400px;
        }

        .search-box input {
            padding-left: 2.5rem;
            width: 100%;
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 0.5rem;
            border-bottom: 2px solid var(--border);
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .tab {
            padding: 0.875rem 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #6c757d;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            color: var(--secondary);
            border-bottom-color: var(--secondary);
        }

        /* Login Page */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary) 0%, #0d3b4c 100%);
            padding: 2rem;
        }

        .login-box {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .login-logo {
            text-align: center;
            margin-bottom: 2rem;
        }

        .login-logo-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--secondary), var(--accent));
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            margin-bottom: 1rem;
            box-shadow: 0 8px 24px rgba(87, 197, 182, 0.4);
        }

        .login-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .login-subtitle {
            color: #6c757d;
        }

        /* Progress Bar */
        .progress-container {
            background: var(--bg);
            border-radius: 10px;
            height: 24px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary), var(--accent));
            border-radius: 10px;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 0.75rem;
            color: white;
            font-size: 0.8rem;
            font-weight: 700;
        }

        /* Toggle Switch */
        .toggle {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
        }

        .toggle-switch {
            width: 50px;
            height: 26px;
            background: var(--border);
            border-radius: 13px;
            position: relative;
            transition: all 0.3s;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: transform 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .toggle.active .toggle-switch {
            background: var(--secondary);
        }

        .toggle.active .toggle-switch::after {
            transform: translateX(24px);
        }

        /* Color Picker */
        .color-picker {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .color-option {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.2s;
        }

        .color-option:hover, .color-option.selected {
            transform: scale(1.2);
            border-color: var(--text);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        /* File Upload */
        .upload-zone {
            border: 3px dashed var(--border);
            border-radius: 16px;
            padding: 3rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #fafafa;
        }

        .upload-zone:hover {
            border-color: var(--secondary);
            background: rgba(87, 197, 182, 0.05);
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .action-card {
            background: white;
            padding: 1.5rem;
            border-radius: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid var(--border);
        }

        .action-card:hover {
            border-color: var(--secondary);
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(0,0,0,0.12);
        }

        .action-icon {
            font-size: 3rem;
            margin-bottom: 0.75rem;
        }

        /* Section Cards */
        .section-card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: all 0.3s;
            border: 2px solid transparent;
            position: relative;
        }

        .section-card:hover {
            border-color: var(--secondary);
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(0,0,0,0.12);
        }

        .section-logo {
            width: 90px;
            height: 90px;
            background: var(--bg);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 2.5rem;
            overflow: hidden;
            border: 3px solid var(--border);
        }

        .section-logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Notification Panel */
        .notification-panel {
            position: absolute;
            top: 60px;
            right: 0;
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            width: 350px;
            max-height: 500px;
            overflow-y: auto;
            display: none;
            z-index: 1500;
        }

        .notification-panel.active {
            display: block;
        }

        .notification-item {
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: background 0.2s;
        }

        .notification-item:hover {
            background: #f8f9fa;
        }

        .notification-item.unread {
            border-left: 4px solid var(--secondary);
        }

        /* Hide/Show sections */
        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Print Styles */
        @media print {
            .header, .nav, .btn, .no-print, .modal {
                display: none !important;
            }
            .main-container {
                margin-top: 0;
                padding: 0;
            }
            .report-preview {
                box-shadow: none;
                border: none;
                page-break-inside: avoid;
            }
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .nav {
                width: 100%;
                justify-content: center;
                overflow-x: auto;
            }

            .main-container {
                margin-top: 140px;
                padding: 1rem;
            }

            .grid-2, .grid-3, .grid-4 {
                grid-template-columns: 1fr;
            }

            .modal-content {
                margin: 0.5rem;
                max-height: 95vh;
            }

            .attendance-status {
                flex-wrap: wrap;
            }

            .lesson-cards {
                grid-template-columns: 1fr;
            }
        }

        /* Loading Spinner */
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border);
            border-top-color: var(--secondary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Tooltip */
        .tooltip {
            position: relative;
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.85rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            margin-bottom: 8px;
            z-index: 100;
        }

        .tooltip:hover::after {
            opacity: 1;
        }

        /* Filter Tags */
        .filter-tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .filter-tag {
            background: var(--bg);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .filter-tag.active {
            background: var(--secondary);
            color: white;
        }

        /* Date Picker Custom */
        input[type="date"] {
            font-family: inherit;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--secondary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #45b5a6;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="login-box">
            <div class="login-logo">
                <div class="login-logo-icon">üìö</div>
                <div class="login-title">Idonet 2.0</div>
                <div class="login-subtitle">Sistema de Gesti√≥n Educativa</div>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">Correo Electr√≥nico</label>
                    <input type="email" id="loginEmail" class="form-control" placeholder="docente@ejemplo.com" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Contrase√±a</label>
                    <input type="password" id="loginPassword" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center;">Iniciar Sesi√≥n</button>
            </form>
            <div style="text-align: center; margin-top: 1.5rem;">
                <a href="#" onclick="showRecoverPassword()" style="color: var(--secondary); text-decoration: none;">¬øOlvidaste tu contrase√±a?</a>
            </div>
            <div style="text-align: center; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border);">
                <span style="color: #6c757d;">¬øNo tienes cuenta? </span>
                <a href="#" onclick="showRegister()" style="color: var(--secondary); text-decoration: none; font-weight: 600;">Reg√≠strate</a>
            </div>
        </div>
    </div>

    <!-- Main App (Hidden initially) -->
    <div id="mainApp" style="display: none;">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo" onclick="showSection('dashboard')">
                    <div class="logo-icon">üìö</div>
                    <span>Idonet 2.0</span>
                </div>
                <nav class="nav">
                    <button class="nav-btn active" onclick="showSection('dashboard')">Inicio</button>
                    <button class="nav-btn" onclick="showSection('instituciones')">Instituciones</button>
                    <button class="nav-btn" onclick="showSection('secciones')">Secciones</button>
                    <button class="nav-btn" onclick="showSection('asignaturas')">Asignaturas</button>
                    <button class="nav-btn" onclick="showSection('horario')">Horario</button>
                    <button class="nav-btn" onclick="showSection('asistencia')">Asistencia</button>
                    <button class="nav-btn" onclick="showSection('evaluaciones')">Evaluaciones</button>
                    <button class="nav-btn" onclick="showSection('bitacora')">Bit√°cora</button>
                    <button class="nav-btn" onclick="showSection('reportes')">Reportes</button>
                </nav>
                <div class="user-menu">
                    <div class="notification-bell" onclick="toggleNotifications()">
                        üîî
                        <span class="notification-badge" id="notifCount" style="display: none;">0</span>
                    </div>
                    <div class="notification-panel" id="notificationPanel">
                        <div style="padding: 1rem; border-bottom: 1px solid var(--border); font-weight: 600;">Notificaciones</div>
                        <div id="notificationList"></div>
                    </div>
                    <div class="user-avatar" onclick="showSection('perfil')" id="userAvatar">D</div>
                </div>
            </div>
        </header>

        <!-- Main Container -->
        <div class="main-container">
            
            <!-- Dashboard Section -->
            <section id="dashboard" class="section active">
                <div class="card">
                    <div class="card-header">
                        <div>
                            <h2 class="card-title">Mis Asignaturas</h2>
                            <p style="color: #6c757d; margin-top: 0.25rem;" id="currentDate"></p>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <select id="dashboardPeriodo" class="form-control" style="width: auto;" onchange="renderDashboard()">
                                <option value="1">I Per√≠odo</option>
                                <option value="2">II Per√≠odo</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="quick-actions no-print">
                        <div class="action-card" onclick="quickAction('asistencia')">
                            <div class="action-icon">‚úÖ</div>
                            <div style="font-weight: 600;">Tomar Asistencia</div>
                            <div style="font-size: 0.85rem; color: #6c757d;">Registro r√°pido</div>
                        </div>
                        <div class="action-card" onclick="quickAction('nota')">
                            <div class="action-icon">üìù</div>
                            <div style="font-weight: 600;">Registrar Nota</div>
                            <div style="font-size: 0.85rem; color: #6c757d;">Evaluaci√≥n</div>
                        </div>
                        <div class="action-card" onclick="quickAction('reporte')">
                            <div class="action-icon">üìä</div>
                            <div style="font-weight: 600;">Generar Reporte</div>
                            <div style="font-size: 0.85rem; color: #6c757d;">PDF/Excel/SEA</div>
                        </div>
                        <div class="action-card" onclick="quickAction('bitacora')">
                            <div class="action-icon">üìñ</div>
                            <div style="font-weight: 600;">Nueva Bit√°cora</div>
                            <div style="font-size: 0.85rem; color: #6c757d;">Registro diario</div>
                        </div>
                    </div>

                    <div id="dashboardSubjects" class="grid grid-3">
                        <!-- Dynamic subject cards -->
                    </div>
                </div>

                <div class="grid grid-2">
                    <div class="card">
                        <h3 style="margin-bottom: 1rem; color: var(--primary);">üìÖ Recordatorios de Hoy</h3>
                        <div id="remindersList">
                            <div class="empty-state" style="padding: 2rem;">
                                <div class="empty-state-icon">üìÖ</div>
                                <p>No hay recordatorios para hoy</p>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <h3 style="margin-bottom: 1rem; color: var(--primary);">üéÇ Cumplea√±os del Mes</h3>
                        <div id="birthdaysList">
                            <div class="empty-state" style="padding: 2rem;">
                                <div class="empty-state-icon">üéÇ</div>
                                <p>No hay cumplea√±os este mes</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Instituciones Section -->
            <section id="instituciones" class="section">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Centros Educativos</h2>
                        <button class="btn btn-primary" onclick="openModal('institucionModal')">
                            ‚ûï Agregar Instituci√≥n
                        </button>
                    </div>
                    <div class="grid grid-3" id="institucionesGrid">
                        <!-- Dynamic content -->
                    </div>
                </div>
            </section>

            <!-- Secciones Section -->
            <section id="secciones" class="section">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Secciones y Grupos</h2>
                        <button class="btn btn-primary" onclick="openModal('seccionModal')">
                            ‚ûï Nueva Secci√≥n
                        </button>
                    </div>
                    <div class="grid grid-4" id="seccionesGrid">
                        <!-- Dynamic content -->
                    </div>
                </div>
            </section>

            <!-- Asignaturas Section -->
            <section id="asignaturas" class="section">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Asignaturas</h2>
                        <button class="btn btn-primary" onclick="openModal('asignaturaModal')">
                            ‚ûï Nueva Asignatura
                        </button>
                    </div>
                    <div class="table-container">
                        <table id="asignaturasTable">
                            <thead>
                                <tr>
                                    <th>Asignatura</th>
                                    <th>Grupo</th>
                                    <th>A√±o</th>
                                    <th>Instituci√≥n</th>
                                    <th>T.Cotidiano</th>
                                    <th>Tareas</th>
                                    <th>Pruebas</th>
                                    <th>Asistencia</th>
                                    <th>Proyecto</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="asignaturasBody">
                                <!-- Dynamic content -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Horario Section -->
            <section id="horario" class="section">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Configuraci√≥n de Horario</h2>
                        <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                            <label>M√°ximo de Lecciones:</label>
                            <input type="number" id="maxLecciones" class="form-control" style="width: 80px;" value="7" min="1" max="20" onchange="updateScheduleGrid()">
                            <label class="toggle" onclick="this.classList.toggle('active')">
                                <div class="toggle-switch"></div>
                                <span>Mostrar Instituciones</span>
                            </label>
                            <button class="btn btn-primary" onclick="saveSchedule()">üíæ Guardar Horario</button>
                        </div>
                    </div>
                    <div class="schedule-container">
                        <div id="scheduleGrid" class="schedule-grid">
                            <!-- Dynamic schedule -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Asistencia Section -->
            <section id="asistencia" class="section">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Registro de Asistencia</h2>
                    </div>
                    
                    <div class="attendance-calendar" id="attendanceCalendar">
                        <!-- Dynamic calendar -->
                    </div>

                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap; align-items: center;">
                        <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                            <input type="checkbox" id="showInstitution" onchange="loadAttendanceLessons()">
                            <span>Mostrar centro educativo</span>
                        </label>
                        <select id="attendanceSeccion" class="form-control" style="width: auto;" onchange="loadAttendanceLessons()">
                            <option value="">Tod las secciones</option>
                        </select>
                        <input type="date" id="attendanceDate" class="form-control" style="width: auto;" onchange="loadAttendanceLessons()">
                    </div>

                    <div id="attendanceLessons" class="lesson-cards">
                        <!-- Dynamic lesson cards -->
                    </div>

                    <div id="attendanceForm" style="display: none; margin-top: 2rem;">
                        <h3 style="margin-bottom: 1rem; color: var(--primary);">
                            Lista de Estudiantes - <span id="attendanceLessonTitle"></span>
                        </h3>
                        <div id="attendanceList" class="attendance-list">
                            <!-- Dynamic attendance list -->
                        </div>
                        <div style="margin-top: 1.5rem; display: flex; gap: 1rem;">
                            <button class="btn btn-primary" onclick="saveAttendance()">üíæ Guardar Asistencia</button>
                            <button class="btn btn-outline" onclick="cancelAttendance()">Cancelar</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Evaluaciones Section -->
            <section id="evaluaciones" class="section">
                <div class="tabs">
                    <button class="tab active" onclick="showEvalTab('trabajo')">Trabajo Cotidiano</button>
                    <button class="tab" onclick="showEvalTab('tareas')">Tareas</button>
                    <button class="tab" onclick="showEvalTab('pruebas')">Pruebas</button>
                    <button class="tab" onclick="showEvalTab('proyecto')">Proyecto</button>
                </div>

                <!-- Trabajo Cotidiano -->
                <div id="eval-trabajo" class="eval-content">
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <h3 class="card-title">Trabajo Cotidiano - Indicadores</h3>
                                <p style="color: #6c757d; font-size: 0.9rem;">Configure indicadores y eval√∫e el desempe√±o diario</p>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn btn-secondary" onclick="openModal('indicadorSimultaneoModal')">‚ûï Agregar a Varios Grupos</button>
                                <button class="btn btn-primary" onclick="openModal('indicadorModal')">‚ûï Agregar Indicador</button>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <select id="tcAsignatura" class="form-control" onchange="loadTrabajoCotidiano()" style="max-width: 400px;">
                                <option value="">Seleccionar Asignatura</option>
                            </select>
                        </div>

                        <div class="acs-tabs">
                            <button class="acs-tab active" onclick="showACSTab('regular')">Estudiantes sin ACS</button>
                            <button class="acs-tab" onclick="showACSTab('acs')">Estudiantes con ACS</button>
                        </div>

                        <div id="acs-regular" class="acs-content active">
                            <div id="indicadoresConfig" style="margin-bottom: 1.5rem;">
                                <!-- Dynamic indicators config -->
                            </div>
                            <div id="tcTableRegular">
                                <!-- Dynamic table -->
                            </div>
                        </div>

                        <div id="acs-acs" class="acs-content">
                            <div id="tcTableACS">
                                <!-- Dynamic table for ACS students -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tareas -->
                <div id="eval-tareas" class="eval-content" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Gesti√≥n de Tareas</h3>
                            <button class="btn btn-primary" onclick="openModal('tareaModal')">‚ûï Nueva Tarea</button>
                        </div>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <select id="tareaAsignatura" class="form-control" onchange="loadTareas()" style="max-width: 400px;">
                                <option value="">Seleccionar Asignatura</option>
                            </select>
                        </div>

                        <div class="acs-tabs">
                            <button class="acs-tab active" onclick="showTareaTab('regular')">Estudiantes sin ACS</button>
                            <button class="acs-tab" onclick="showTareaTab('acs')">Estudiantes con ACS</button>
                        </div>

                        <div id="tarea-regular" class="acs-content active">
                            <div id="tareasConfig" style="margin-bottom: 1.5rem;">
                                <!-- Dynamic tasks config -->
                            </div>
                            <div id="tareasTableRegular">
                                <!-- Dynamic table -->
                            </div>
                        </div>

                        <div id="tarea-acs" class="acs-content">
                            <div id="tareasTableACS">
                                <!-- Dynamic table for ACS -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pruebas -->
                <div id="eval-pruebas" class="eval-content" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Pruebas y Ex√°menes</h3>
                            <button class="btn btn-primary" onclick="openModal('pruebaModal')">‚ûï Nueva Prueba</button>
                        </div>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <select id="pruebaAsignatura" class="form-control" onchange="loadPruebas()" style="max-width: 400px;">
                                <option value="">Seleccionar Asignatura</option>
                            </select>
                        </div>

                        <div class="acs-tabs">
                            <button class="acs-tab active" onclick="showPruebaTab('regular')">Estudiantes sin ACS</button>
                            <button class="acs-tab" onclick="showPruebaTab('acs')">Estudiantes con ACS</button>
                        </div>

                        <div id="prueba-regular" class="acs-content active">
                            <div id="pruebasConfig" style="margin-bottom: 1.5rem;"></div>
                            <div id="pruebasTableRegular"></div>
                        </div>

                        <div id="prueba-acs" class="acs-content">
                            <div id="pruebasTableACS"></div>
                        </div>
                    </div>
                </div>

                <!-- Proyecto -->
                <div id="eval-proyecto" class="eval-content" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Evaluaci√≥n de Proyecto</h3>
                        </div>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <select id="proyectoAsignatura" class="form-control" onchange="loadProyecto()" style="max-width: 400px;">
                                <option value="">Seleccionar Asignatura</option>
                            </select>
                        </div>

                        <div id="proyectoContent">
                            <!-- Dynamic project evaluation -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Bit√°cora Section -->
            <section id="bitacora" class="section">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Bit√°cora de Clase</h2>
                        <button class="btn btn-primary" onclick="openModal('bitacoraModal')">‚ûï Nueva Entrada</button>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
                        <select id="bitacoraFiltroAsignatura" class="form-control" style="width: auto;" onchange="renderBitacoras()">
                            <option value="">Todas las asignaturas</option>
                        </select>
                        <div class="search-box" style="flex: 1; max-width: 400px;">
                            <span class="search-icon">üîç</span>
                            <input type="text" id="bitacoraSearch" class="form-control" placeholder="Buscar contenido..." onkeyup="renderBitacoras()">
                        </div>
                        <button class="btn btn-secondary" onclick="exportarBitacoraWord()">üìù Descargar en Word</button>
                    </div>

                    <div id="bitacoraList">
                        <!-- Dynamic entries -->
                    </div>
                </div>
            </section>

            <!-- Reportes Section -->
            <section id="reportes" class="section">
                <div class="tabs">
                    <button class="tab active" onclick="showReportTab('periodo')">Reporte por Per√≠odo (SEA)</button>
                    <button class="tab" onclick="showReportTab('anual')">Reporte Anual</button>
                    <button class="tab" onclick="showReportTab('individual')">Reporte Individual</button>
                    <button class="tab" onclick="showReportTab('asistencia')">Reporte de Asistencia</button>
                </div>

                <!-- Reporte por Per√≠odo -->
                <div id="report-periodo" class="report-content">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Reporte por Per√≠odo - Compatible con SEA</h3>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap; align-items: end;">
                            <div>
                                <label class="form-label">Per√≠odo</label>
                                <select id="reportePeriodo" class="form-control" onchange="generarReportePeriodo()">
                                    <option value="1">I Per√≠odo</option>
                                    <option value="2">II Per√≠odo</option>
                                </select>
                            </div>
                            <div>
                                <label class="form-label">Asignatura</label>
                                <select id="reporteAsignaturaPeriodo" class="form-control" onchange="generarReportePeriodo()">
                                    <option value="">Seleccionar...</option>
                                </select>
                            </div>
                            <div>
                                <label class="form-label">Decimales</label>
                                <select id="reporteDecimales" class="form-control" onchange="generarReportePeriodo()">
                                    <option value="0">0</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                </select>
                            </div>
                            <div class="search-box">
                                <span class="search-icon">üîç</span>
                                <input type="text" id="reporteBuscar" class="form-control" placeholder="Filtrar por nombre..." onkeyup="generarReportePeriodo()">
                            </div>
                        </div>

                        <div style="display: flex; gap: 0.5rem; margin-bottom: 1.5rem;" class="no-print">
                            <button class="btn btn-success" onclick="exportarReportePDF()">üìÑ PDF</button>
                            <button class="btn btn-secondary" onclick="exportarReporteWord()">üìù Word</button>
                            <button class="btn btn-success" onclick="exportarReporteExcel()">üìä Excel</button>
                            <button class="btn btn-warning" onclick="exportarReporteSEA()">üåê CSV para SEA</button>
                        </div>

                        <div id="reportePeriodoTabla" class="table-container">
                            <!-- Dynamic report table -->
                        </div>
                    </div>
                </div>

                <!-- Reporte Anual -->
                <div id="report-anual" class="report-content" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Reporte Anual</h3>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
                            <select id="reporteAsignaturaAnual" class="form-control" style="max-width: 300px;" onchange="generarReporteAnual()">
                                <option value="">Seleccionar Asignatura...</option>
                            </select>
                            <select id="reporteDecimalesAnual" class="form-control" style="width: auto;" onchange="generarReporteAnual()">
                                <option value="0">0 decimales</option>
                                <option value="1">1 decimal</option>
                                <option value="2">2 decimales</option>
                            </select>
                            <select id="reporteOrdenAnual" class="form-control" style="width: auto;" onchange="generarReporteAnual()">
                                <option value="alfabetico">Orden alfab√©tico</option>
                                <option value="nota">Por nota</option>
                            </select>
                            <select id="reporteFiltroNota" class="form-control" style="width: auto;" onchange="generarReporteAnual()">
                                <option value="todos">Mostrar todos</option>
                                <option value="aprobados">Aprobados</option>
                                <option value="reprobados">Reprobados</option>
                            </select>
                        </div>

                        <div id="reporteAnualContent">
                            <!-- Dynamic annual report -->
                        </div>
                    </div>
                </div>

                <!-- Reporte Individual -->
                <div id="report-individual" class="report-content" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Reporte Individual por Estudiante</h3>
                        </div>
                        
                        <div style="margin-bottom: 1.5rem;">
                            <select id="reporteAsignaturaIndividual" class="form-control" style="max-width: 400px;" onchange="loadEstudiantesReporteIndividual()">
                                <option value="">Seleccionar Asignatura...</option>
                            </select>
                        </div>

                        <div id="reporteIndividualList">
                            <!-- Dynamic student list -->
                        </div>
                    </div>
                </div>

                <!-- Reporte de Asistencia -->
                <div id="report-asistencia" class="report-content" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Reporte de Asistencia</h3>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
                            <div>
                                <label class="form-label">Desde</label>
                                <input type="date" id="asistenciaDesde" class="form-control">
                            </div>
                            <div>
                                <label class="form-label">Hasta</label>
                                <input type="date" id="asistenciaHasta" class="form-control">
                            </div>
                            <div>
                                <label class="form-label">Secci√≥n</label>
                                <select id="asistenciaReporteSeccion" class="form-control">
                                    <option value="">Todas</option>
                                </select>
                            </div>
                            <div>
                                <label class="form-label">Asignatura</label>
                                <select id="asistenciaReporteAsignatura" class="form-control">
                                    <option value="">Todas</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" onclick="generarReporteAsistencia()" style="align-self: flex-end;">Generar</button>
                        </div>

                        <div id="reporteAsistenciaContent">
                            <!-- Dynamic attendance report -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Perfil Section -->
            <section id="perfil" class="section">
                <div class="grid grid-2">
                    <div class="card">
                        <h3 class="card-title" style="margin-bottom: 1.5rem;">üë§ Datos del Docente</h3>
                        <div class="form-group">
                            <label class="form-label">Nombre Completo</label>
                            <input type="text" id="perfilNombre" class="form-control">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Correo Electr√≥nico</label>
                            <input type="email" id="perfilEmail" class="form-control" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tel√©fono</label>
                            <input type="tel" id="perfilTelefono" class="form-control">
                        </div>
                        <button class="btn btn-primary" onclick="guardarPerfil()">üíæ Guardar Cambios</button>
                    </div>

                    <div class="card">
                        <h3 class="card-title" style="margin-bottom: 1.5rem;">üîí Seguridad</h3>
                        
                        <div style="margin-bottom: 1.5rem; padding-bottom: 1.5rem; border-bottom: 1px solid var(--border);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <div>
                                    <div style="font-weight: 600;">Autenticaci√≥n en Dos Factores (2FA)</div>
                                    <div style="font-size: 0.9rem; color: #6c757d;">A√±ade seguridad adicional</div>
                                </div>
                                <div class="toggle" id="toggle2FA" onclick="toggle2FA()">
                                    <div class="toggle-switch"></div>
                                </div>
                            </div>
                            <div id="config2FA" style="display: none;">
                                <div class="form-group">
                                    <label class="form-label">C√≥digo de verificaci√≥n</label>
                                    <input type="text" class="form-control" placeholder="000000">
                                </div>
                                <button class="btn btn-secondary btn-sm">Configurar</button>
                            </div>
                        </div>

                        <div style="margin-bottom: 1.5rem;">
                            <div style="font-weight: 600; margin-bottom: 0.5rem;">Exportar Datos</div>
                            <button class="btn btn-outline" onclick="exportarBackup()">üíæ Exportar Backup Completo</button>
                        </div>

                        <div>
                            <div style="font-weight: 600; margin-bottom: 0.5rem;">Importar Datos</div>
                            <div class="upload-zone" onclick="document.getElementById('importFile').click()">
                                <div style="font-size: 2.5rem; margin-bottom: 0.5rem;">üìÅ</div>
                                <div>Arrastra archivos o haz clic para seleccionar</div>
                                <div style="font-size: 0.85rem; color: #6c757d; margin-top: 0.5rem;">Archivo .json de backup</div>
                            </div>
                            <input type="file" id="importFile" style="display: none;" accept=".json" onchange="importarBackup(this)">
                        </div>

                        <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--border);">
                            <button class="btn btn-danger" onclick="cerrarSesion()">üö™ Cerrar Sesi√≥n</button>
                        </div>
                    </div>
                </div>

                <div class="card" style="margin-top: 1.5rem;">
                    <h3 class="card-title" style="margin-bottom: 1.5rem;">üåê Sesiones Activas</h3>
                    <div id="sesionesList">
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #f8f9fa; border-radius: 8px; margin-bottom: 0.75rem;">
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <span style="font-size: 1.5rem;">üíª</span>
                                <div>
                                    <div style="font-weight: 600;">Windows - Chrome</div>
                                    <div style="font-size: 0.85rem; color: #6c757d;">45.239.67.17 - Este dispositivo</div>
                                </div>
                            </div>
                            <span class="badge badge-success">Activo</span>
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="cerrarOtrasSesiones()">Cerrar sesiones en otros navegadores</button>
                </div>
            </section>

        </div>
    </div>

    <!-- Modals -->

    <!-- Instituci√≥n Modal -->
    <div id="institucionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nueva Instituci√≥n</h3>
                <button class="close-btn" onclick="closeModal('institucionModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Nombre del Centro Educativo *</label>
                    <input type="text" id="instNombre" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Direcci√≥n Regional *</label>
                    <input type="text" id="instRegional" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Circuito Escolar *</label>
                    <input type="text" id="instCircuito" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">C√≥digo *</label>
                    <input type="text" id="instCodigo" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Logo (URL o Base64)</label>
                    <input type="text" id="instLogo" class="form-control" placeholder="Opcional">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('institucionModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="guardarInstitucion()">Guardar Instituci√≥n</button>
            </div>
        </div>
    </div>

    <!-- Secci√≥n Modal -->
    <div id="seccionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nueva Secci√≥n</h3>
                <button class="close-btn" onclick="closeModal('seccionModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Nombre de la Secci√≥n * (ej: 9-1)</label>
                    <input type="text" id="secNombre" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Instituci√≥n *</label>
                    <select id="secInstitucion" class="form-control" required>
                        <option value="">Seleccionar...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">A√±o Lectivo *</label>
                    <input type="number" id="secAnio" class="form-control" value="2025" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Cantidad de Per√≠odos *</label>
                    <select id="secPeriodos" class="form-control" required>
                        <option value="2">2 Per√≠odos</option>
                        <option value="3">3 Per√≠odos</option>
                    </select>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label class="form-label">% Per√≠odo 1</label>
                        <input type="number" id="secP1" class="form-control" value="40" min="0" max="100">
                    </div>
                    <div class="form-group">
                        <label class="form-label">% Per√≠odo 2</label>
                        <input type="number" id="secP2" class="form-control" value="60" min="0" max="100">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('seccionModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="guardarSeccion()">Guardar Secci√≥n</button>
            </div>
        </div>
    </div>

    <!-- Asignatura Modal -->
    <div id="asignaturaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nueva Asignatura</h3>
                <button class="close-btn" onclick="closeModal('asignaturaModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Nombre de la Asignatura *</label>
                    <input type="text" id="asigNombre" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Secci√≥n *</label>
                    <select id="asigSeccion" class="form-control" required>
                        <option value="">Seleccionar...</option>
                    </select>
                </div>
                <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                    <div style="font-weight: 600; margin-bottom: 0.75rem;">Distribuci√≥n de Porcentajes * (debe sumar 100%)</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group" style="margin-bottom: 0.5rem;">
                            <label class="form-label">Trabajo Cotidiano (%)</label>
                            <input type="number" id="asigTC" class="form-control" value="50" min="0" max="100" onchange="validarPorcentajes()">
                        </div>
                        <div class="form-group" style="margin-bottom: 0.5rem;">
                            <label class="form-label">Tareas (%)</label>
                            <input type="number" id="asigTareas" class="form-control" value="10" min="0" max="100" onchange="validarPorcentajes()">
                        </div>
                        <div class="form-group" style="margin-bottom: 0.5rem;">
                            <label class="form-label">Pruebas (%)</label>
                            <input type="number" id="asigPruebas" class="form-control" value="30" min="0" max="100" onchange="validarPorcentajes()">
                        </div>
                        <div class="form-group" style="margin-bottom: 0.5rem;">
                            <label class="form-label">Asistencia (%)</label>
                            <input type="number" id="asigAsistencia" class="form-control" value="10" min="0" max="100" onchange="validarPorcentajes()">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Proyecto (%)</label>
                            <input type="number" id="asigProyecto" class="form-control" value="0" min="0" max="100" onchange="validarPorcentajes()">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Nota M√≠nima (1-100)</label>
                            <input type="number" id="asigMinima" class="form-control" value="65" min="1" max="100">
                        </div>
                    </div>
                    <div id="porcentajeWarning" style="color: var(--danger); font-size: 0.9rem; margin-top: 0.75rem; display: none;">
                        ‚ö†Ô∏è La suma de porcentajes debe ser exactamente 100%
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('asignaturaModal')">Cancelar</button>
                <button class="btn btn-primary" id="btnGuardarAsignatura" onclick="guardarAsignatura()">Guardar Asignatura</button>
            </div>
        </div>
    </div>

    <!-- Estudiante Modal -->
    <div id="estudianteModal" class="modal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3 id="estModalTitle">Nuevo Estudiante</h3>
                <button class="close-btn" onclick="closeModal('estudianteModal')">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="estId">
                <input type="hidden" id="estSeccionId">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label class="form-label">C√©dula/ID *</label>
                        <input type="text" id="estCedula" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Nombre Completo *</label>
                        <input type="text" id="estNombre" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Encargado 1 *</label>
                        <input type="text" id="estEnc1" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tel√©fono 1 *</label>
                        <input type="tel" id="estTel1" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Encargado 2</label>
                        <input type="text" id="estEnc2" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tel√©fono 2</label>
                        <input type="tel" id="estTel2" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Fecha de Nacimiento</label>
                        <input type="date" id="estNacimiento" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Correo MEP</label>
                        <input type="email" id="estEmail" class="form-control" placeholder="@est.mep.go.cr">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Adecuaci√≥n Curricular</label>
                    <select id="estAdecuacion" class="form-control">
                        <option value="ninguna">Ninguna</option>
                        <option value="significativa">Adecuaci√≥n Curricular Significativa (ACS)</option>
                        <option value="no_significativa">Adecuaci√≥n Curricular No Significativa</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('estudianteModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="guardarEstudiante()">Guardar Estudiante</button>
            </div>
        </div>
    </div>

    <!-- Indicador Modal -->
    <div id="indicadorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Agregar Indicador</h3>
                <button class="close-btn" onclick="closeModal('indicadorModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Descripci√≥n del Indicador *</label>
                    <textarea id="indDescripcion" class="form-control" rows="3" placeholder="Ej: Analiza cr√≠ticamente las causas y consecuencias..." required></textarea>
                    <div style="text-align: right; font-size: 0.85rem; color: #6c757d; margin-top: 0.25rem;">
                        <span id="indContador">0</span>/255 caracteres
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Fecha de Evaluaci√≥n</label>
                    <input type="date" id="indFecha" class="form-control">
                </div>
                <div class="form-group">
                    <label class="form-label">Puntos por indicador *</label>
                    <input type="number" id="indPuntos" class="form-control" value="3" min="1" max="10" required>
                </div>
                <div class="form-group">
                    <label class="form-label">¬øEs para estudiantes con ACS?</label>
                    <select id="indACS" class="form-control">
                        <option value="no">No - Estudiantes regulares</option>
                        <option value="si">S√≠ - Estudiantes con ACS</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('indicadorModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="guardarIndicador()">Guardar Indicador</button>
            </div>
        </div>
    </div>

    <!-- Indicador Simult√°neo Modal -->
    <div id="indicadorSimultaneoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Agregar Indicador a Varios Grupos</h3>
                <button class="close-btn" onclick="closeModal('indicadorSimultaneoModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Descripci√≥n del Indicador *</label>
                    <textarea id="indSimDescripcion" class="form-control" rows="3" required></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Seleccionar Asignaturas (misma materia, diferentes grupos)</label>
                    <div id="indSimAsignaturas" style="max-height: 200px; overflow-y: auto; border: 1px solid var(--border); border-radius: 8px; padding: 0.5rem;">
                        <!-- Checkboxes din√°micos -->
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Puntos por indicador</label>
                    <input type="number" id="indSimPuntos" class="form-control" value="3" min="1" max="10">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('indicadorSimultaneoModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="guardarIndicadorSimultaneo()">Agregar a Seleccionados</button>
            </div>
        </div>
    </div>

    <!-- Tarea Modal -->
    <div id="tareaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nueva Tarea</h3>
                <button class="close-btn" onclick="closeModal('tareaModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Nombre de la Tarea *</label>
                    <input type="text" id="tareaNombre" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Puntos m√°ximos *</label>
                    <input type="number" id="tareaPuntos" class="form-control" value="20" min="1" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Porcentaje del componente Tareas *</label>
                    <input type="number" id="tareaPorcentaje" class="form-control" value="5" min="0.1" max="100" step="0.01" required>
                    <div style="font-size: 0.85rem; color: #6c757d; margin-top: 0.25rem;">
                        Este porcentaje se suma al total del componente Tareas
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Fecha de entrega</label>
                    <input type="date" id="tareaFecha" class="form-control">
                </div>
                <div class="form-group">
                    <label class="form-label">¬øEs para estudiantes con ACS?</label>
                    <select id="tareaACS" class="form-control">
                        <option value="no">No - Estudiantes regulares</option>
                        <option value="si">S√≠ - Estudiantes con ACS</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('tareaModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="guardarTarea()">Guardar Tarea</button>
            </div>
        </div>
    </div>

    <!-- Prueba Modal -->
    <div id="pruebaModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nueva Prueba</h3>
                <button class="close-btn" onclick="closeModal('pruebaModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Nombre de la Prueba *</label>
                    <input type="text" id="pruebaNombre" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Puntos m√°ximos *</label>
                    <input type="number" id="pruebaPuntos" class="form-control" value="100" min="1" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Porcentaje del componente Pruebas *</label>
                    <input type="number" id="pruebaPorcentaje" class="form-control" value="15" min="0.1" max="100" step="0.01" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Fecha de evaluaci√≥n *</label>
                    <input type="date" id="pruebaFecha" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">¬øEs para estudiantes con ACS?</label>
                    <select id="pruebaACS" class="form-control">
                        <option value="no">No - Estudiantes regulares</option>
                        <option value="si">S√≠ - Estudiantes con ACS</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('pruebaModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="guardarPrueba()">Guardar Prueba</button>
            </div>
        </div>
    </div>

    <!-- Bit√°cora Modal -->
    <div id="bitacoraModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Nueva Bit√°cora</h3>
                <button class="close-btn" onclick="closeModal('bitacoraModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Asignatura *</label>
                    <select id="bitAsignatura" class="form-control" required>
                        <option value="">Seleccionar...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Fecha *</label>
                    <input type="date" id="bitFecha" class="form-control" required>
                </div>
                <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                    <div style="font-weight: 600; margin-bottom: 0.75rem;">Estructura de la Clase</div>
                    <div class="form-group">
                        <label class="form-label">Tema</label>
                        <input type="text" id="bitTema" class="form-control" placeholder="Tema de la clase">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Objetivo de la clase</label>
                        <input type="text" id="bitObjetivo" class="form-control" placeholder="Objetivo espec√≠fico">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Actividades realizadas</label>
                        <textarea id="bitActividades" class="form-control" rows="2" placeholder="Describa las actividades..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Recursos utilizados</label>
                        <input type="text" id="bitRecursos" class="form-control" placeholder="Materiales, tecnolog√≠a, etc.">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label class="form-label">Observaciones</label>
                        <textarea id="bitObservaciones" class="form-control" rows="2" placeholder="Observaciones sobre el desarrollo de la clase..."></textarea>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Contenido completo / Notas adicionales</label>
                    <textarea id="bitContenido" class="form-control" rows="4" placeholder="Desarrollo detallado..."></textarea>
                    <div style="text-align: right; font-size: 0.85rem; color: #6c757d; margin-top: 0.25rem;">
                        <span id="bitContador">0</span>/2000 caracteres
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Fecha de Recordatorio (opcional)</label>
                    <input type="date" id="bitRecordatorio" class="form-control">
                    <div style="font-size: 0.85rem; color: #6c757d; margin-top: 0.25rem;">
                        Se mostrar√° una notificaci√≥n en el dashboard
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('bitacoraModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="guardarBitacora()">Guardar Bit√°cora</button>
            </div>
        </div>
    </div>

    <!-- Configurar Reporte Individual Modal -->
    <div id="configReporteIndividualModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Configurar Reporte Individual</h3>
                <button class="close-btn" onclick="closeModal('configReporteIndividualModal')">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="configRepEstudianteId">
                <div class="config-section">
                    <div class="config-title">üóì Seleccionar Per√≠odos:</div>
                    <div class="checkbox-group">
                        <label class="checkbox-item">
                            <input type="checkbox" id="repPer1" checked>
                            <span>Per√≠odo 1</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="repPer2" checked>
                            <span>Per√≠odo 2</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="repPerTodos" onchange="toggleTodosPeriodos(this)">
                            <span>Todos los per√≠odos</span>
                        </label>
                    </div>
                </div>
                <div class="config-section">
                    <div class="config-title">üìã Seleccionar Componentes:</div>
                    <div class="checkbox-group">
                        <label class="checkbox-item">
                            <input type="checkbox" id="repCompTC" checked>
                            <span>Trabajo cotidiano</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="repCompTareas" checked>
                            <span>Tareas</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="repCompPruebas" checked>
                            <span>Pruebas</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="repCompAsistencia" checked>
                            <span>Asistencia</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="repCompAusencias" checked>
                            <span>Reporte de ausencias y tardanzas</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="repCompResumen" checked>
                            <span>Resumen del per√≠odo</span>
                        </label>
                        <label class="checkbox-item">
                            <input type="checkbox" id="repCompTodos" onchange="toggleTodosComponentes(this)">
                            <span>Todos los componentes</span>
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Texto introductorio del reporte</label>
                    <textarea id="repIntro" class="form-control" rows="2">Este reporte presenta un resumen de las calificaciones obtenidas por el estudiante en las diferentes evaluaciones realizadas.</textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('configReporteIndividualModal')">Cancelar</button>
                <button class="btn btn-primary" onclick="generarReporteIndividualPDF()">üìÑ Generar PDF</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // ==========================================
        // IDONET 2.0 - SISTEMA COMPLETO Y FUNCIONAL
        // ==========================================

        // Estado global de la aplicaci√≥n
        const AppState = {
            currentUser: null,
            currentSection: 'login',
            data: {
                users: [],
                instituciones: [],
                secciones: [],
                estudiantes: [],
                asignaturas: [],
                horario: [],
                asistencia: [],
                bitacoras: [],
                indicadores: [],
                tareas: [],
                pruebas: [],
                proyecto: [],
                notas: {
                    tc: {},
                    tareas: {},
                    pruebas: {},
                    proyecto: {},
                    asistencia: {}
                }
            }
        };

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            loadDataFromStorage();
            initDateInputs();
            
            // Configurar contadores de caracteres
            setupCharCounters();
            
            // Verificar sesi√≥n
            checkSession();
        });

        function setupCharCounters() {
            const indDescripcion = document.getElementById('indDescripcion');
            if (indDescripcion) {
                indDescripcion.addEventListener('input', function() {
                    document.getElementById('indContador').textContent = this.value.length;
                });
            }
            
            const bitContenido = document.getElementById('bitContenido');
            if (bitContenido) {
                bitContenido.addEventListener('input', function() {
                    document.getElementById('bitContador').textContent = this.value.length;
                });
            }
        }

        function initDateInputs() {
            const today = new Date().toISOString().split('T')[0];
            const dateInputs = document.querySelectorAll('input[type="date"]');
            dateInputs.forEach(input => {
                if (!input.value) input.value = today;
            });
            
            document.getElementById('currentDate').textContent = new Date().toLocaleDateString('es-ES', {
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
            });
        }

        // ==========================================
        // AUTENTICACI√ìN
        // ==========================================

        function checkSession() {
            const session = localStorage.getItem('idonet_session');
            if (session) {
                AppState.currentUser = JSON.parse(session);
                showMainApp();
            } else {
                showLoginScreen();
            }
        }

        function showLoginScreen() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
        }

        function showMainApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            // Actualizar avatar
            const nombre = AppState.currentUser?.nombre || 'D';
            document.getElementById('userAvatar').textContent = nombre.charAt(0).toUpperCase();
            
            // Cargar datos iniciales
            renderDashboard();
            updateNotifications();
        }

        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // Buscar usuario o crear demo
            let user = AppState.data.users.find(u => u.email === email);
            if (!user && email === 'demo@idonet.com') {
                user = {
                    id: Date.now(),
                    nombre: 'Docente Demo',
                    email: email,
                    password: 'demo123',
                    telefono: '8888-8888'
                };
                AppState.data.users.push(user);
                saveDataToStorage();
            }
            
            if (user && user.password === password) {
                AppState.currentUser = user;
                localStorage.setItem('idonet_session', JSON.stringify(user));
                showMainApp();
                showToast('¬°Bienvenido a Idonet 2.0!', 'success');
            } else {
                showToast('Credenciales incorrectas', 'error');
            }
        });

        function showRegister() {
            const email = prompt('Ingrese su correo electr√≥nico:');
            if (email) {
                const nombre = prompt('Ingrese su nombre completo:');
                const password = prompt('Cree una contrase√±a:');
                
                const user = {
                    id: Date.now(),
                    nombre: nombre || 'Docente',
                    email: email,
                    password: password || '123456',
                    telefono: ''
                };
                
                AppState.data.users.push(user);
                saveDataToStorage();
                showToast('Usuario registrado. Por favor inicie sesi√≥n.', 'success');
            }
        }

        function showRecoverPassword() {
            const email = prompt('Ingrese su correo para recuperar contrase√±a:');
            if (email) {
                showToast('Se ha enviado un enlace de recuperaci√≥n (simulado)', 'success');
            }
        }

        function cerrarSesion() {
            localStorage.removeItem('idonet_session');
            AppState.currentUser = null;
            showLoginScreen();
            showToast('Sesi√≥n cerrada', 'success');
        }

        // ==========================================
        // NAVEGACI√ìN
        // ==========================================

        function showSection(sectionId) {
            // Ocultar todas las secciones
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            
            // Mostrar secci√≥n seleccionada
            const section = document.getElementById(sectionId);
            if (section) {
                section.classList.add('active');
                AppState.currentSection = sectionId;
            }
            
            // Actualizar botones de navegaci√≥n
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('onclick')?.includes(sectionId)) {
                    btn.classList.add('active');
                }
            });
            
            // Cerrar panel de notificaciones
            document.getElementById('notificationPanel').classList.remove('active');
            
            // Renderizar contenido espec√≠fico
            switch(sectionId) {
                case 'dashboard':
                    renderDashboard();
                    break;
                case 'instituciones':
                    renderInstituciones();
                    break;
                case 'secciones':
                    renderSecciones();
                    break;
                case 'asignaturas':
                    renderAsignaturas();
                    populateSelects();
                    break;
                case 'horario':
                    renderScheduleGrid();
                    break;
                case 'asistencia':
                    initAsistencia();
                    break;
                case 'evaluaciones':
                    initEvaluaciones();
                    break;
                case 'bitacora':
                    renderBitacoras();
                    break;
                case 'reportes':
                    initReportes();
                    break;
                case 'perfil':
                    loadPerfil();
                    break;
            }
        }

        function showEvalTab(tab) {
            document.querySelectorAll('.eval-content').forEach(e => e.style.display = 'none');
            document.getElementById('eval-' + tab).style.display = 'block';
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            // Cargar datos espec√≠ficos
            if (tab === 'trabajo') loadTrabajoCotidiano();
            else if (tab === 'tareas') loadTareas();
            else if (tab === 'pruebas') loadPruebas();
            else if (tab === 'proyecto') loadProyecto();
        }

        function showACSTab(tab) {
            document.querySelectorAll('.acs-content').forEach(c => c.classList.remove('active'));
            document.getElementById('acs-' + tab).classList.add('active');
            document.querySelectorAll('.acs-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
        }

        function showTareaTab(tab) {
            document.querySelectorAll('#eval-tareas .acs-content').forEach(c => c.classList.remove('active'));
            document.getElementById('tarea-' + tab).classList.add('active');
            document.querySelectorAll('#eval-tareas .acs-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
        }

        function showPruebaTab(tab) {
            document.querySelectorAll('#eval-pruebas .acs-content').forEach(c => c.classList.remove('active'));
            document.getElementById('prueba-' + tab).classList.add('active');
            document.querySelectorAll('#eval-pruebas .acs-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
        }

        function showReportTab(tab) {
            document.querySelectorAll('.report-content').forEach(c => c.style.display = 'none');
            document.getElementById('report-' + tab).style.display = 'block';
            document.querySelectorAll('#reportes .tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            if (tab === 'periodo') generarReportePeriodo();
            else if (tab === 'anual') generarReporteAnual();
            else if (tab === 'individual') loadEstudiantesReporteIndividual();
            else if (tab === 'asistencia') initReporteAsistencia();
        }

        // ==========================================
        // DASHBOARD
        // ==========================================

        function renderDashboard() {
            const periodo = document.getElementById('dashboardPeriodo')?.value || '1';
            const container = document.getElementById('dashboardSubjects');
            
            if (!container) return;
            
            if (AppState.data.asignaturas.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <div class="empty-state-icon">üìö</div>
                        <p>No hay asignaturas registradas</p>
                        <button class="btn btn-primary" onclick="showSection('asignaturas')" style="margin-top: 1rem;">
                            Crear primera asignatura
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = AppState.data.asignaturas.map(asig => {
                const sec = AppState.data.secciones.find(s => s.id === asig.seccionId);
                const inst = sec ? AppState.data.instituciones.find(i => i.id === sec.institucionId) : null;
                
                return `
                    <div class="subject-card">
                        <div class="subject-header">
                            <div class="subject-name">${asig.nombre}</div>
                            <div class="subject-meta">
                                Secci√≥n: ${sec?.nombre || 'N/A'} | ${inst?.nombre || 'N/A'}<br>
                                A√±o: ${sec?.anio || '2025'}
                            </div>
                        </div>
                        
                        <div class="period-section">
                            <div class="period-title">Per√≠odo ${periodo}</div>
                            <div class="action-buttons">
                                <button class="action-btn btn-tc" onclick="openEvaluacion(${asig.id}, 'tc', ${periodo})">Trabajo Cotidiano</button>
                                <button class="action-btn btn-tareas" onclick="openEvaluacion(${asig.id}, 'tareas', ${periodo})">Tareas</button>
                                <button class="action-btn btn-pruebas" onclick="openEvaluacion(${asig.id}, 'pruebas', ${periodo})">Pruebas</button>
                                <button class="action-btn btn-asistencia" onclick="openAsistencia(${asig.id}, ${periodo})">Asistencia</button>
                                ${asig.proyecto > 0 ? `<button class="action-btn btn-proyecto" onclick="openEvaluacion(${asig.id}, 'proyecto', ${periodo})">Proyecto</button>` : ''}
                                <button class="action-btn btn-reporte" onclick="openReporte(${asig.id}, ${periodo})">Reporte Final</button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            renderReminders();
            renderBirthdays();
        }

        function openEvaluacion(asigId, tipo, periodo) {
            showSection('evaluaciones');
            document.getElementById('dashboardPeriodo').value = periodo;
            
            // Seleccionar asignatura en el select correspondiente
            const selectMap = {
                'tc': 'tcAsignatura',
                'tareas': 'tareaAsignatura',
                'pruebas': 'pruebaAsignatura',
                'proyecto': 'proyectoAsignatura'
            };
            
            const selectId = selectMap[tipo];
            if (selectId) {
                const select = document.getElementById(selectId);
                if (select) {
                    select.value = asigId;
                    select.dispatchEvent(new Event('change'));
                }
            }
            
            // Activar tab correspondiente
            const tabMap = {
                'tc': 'trabajo',
                'tareas': 'tareas',
                'pruebas': 'pruebas',
                'proyecto': 'proyecto'
            };
            
            const tabBtn = document.querySelector(`.tab[onclick="showEvalTab('${tabMap[tipo]}')"]`);
            if (tabBtn) tabBtn.click();
        }

        function openAsistencia(asigId, periodo) {
            showSection('asistencia');
            // Pre-seleccionar asignatura si es posible
        }

        function openReporte(asigId, periodo) {
            showSection('reportes');
            document.getElementById('reportePeriodo').value = periodo;
            document.getElementById('reporteAsignaturaPeriodo').value = asigId;
            generarReportePeriodo();
        }

        function quickAction(action) {
            switch(action) {
                case 'asistencia':
                    showSection('asistencia');
                    break;
                case 'nota':
                    showSection('evaluaciones');
                    break;
                case 'reporte':
                    showSection('reportes');
                    break;
                case 'bitacora':
                    showSection('bitacora');
                    break;
            }
        }

        function renderReminders() {
            const container = document.getElementById('remindersList');
            const hoy = new Date().toISOString().split('T')[0];
            
            const reminders = AppState.data.bitacoras.filter(b => {
                if (!b.recordatorio) return false;
                const recDate = new Date(b.recordatorio).toISOString().split('T')[0];
                return recDate === hoy;
            });
            
            if (reminders.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="padding: 2rem;">
                        <div class="empty-state-icon">üìÖ</div>
                        <p>No hay recordatorios para hoy</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = reminders.map(r => {
                const asig = AppState.data.asignaturas.find(a => a.id === r.asignaturaId);
                return `
                    <div class="attendance-item" style="cursor: pointer;" onclick="verBitacora(${r.id})">
                        <div>
                            <strong>${asig?.nombre || 'General'}</strong>
                            <div style="font-size: 0.9rem; color: #6c757d;">${r.tema || 'Sin tema espec√≠fico'}</div>
                        </div>
                        <span class="badge badge-warning">Pendiente</span>
                    </div>
                `;
            }).join('');
        }

        function renderBirthdays() {
            const container = document.getElementById('birthdaysList');
            const mesActual = new Date().getMonth();
            
            const cumpleaneros = AppState.data.estudiantes.filter(e => {
                if (!e.nacimiento) return false;
                return new Date(e.nacimiento).getMonth() === mesActual;
            });
            
            if (cumpleaneros.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="padding: 2rem;">
                        <div class="empty-state-icon">üéÇ</div>
                        <p>No hay cumplea√±os este mes</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = cumpleaneros.map(c => `
                <div class="attendance-item">
                    <div class="attendance-student">
                        <div class="student-avatar">üéâ</div>
                        <div>
                            <strong>${c.nombre}</strong>
                            <div style="font-size: 0.9rem; color: #6c757d;">
                                ${new Date(c.nacimiento).toLocaleDateString('es-ES', { day: 'numeric', month: 'long' })}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // ==========================================
        // INSTITUCIONES
        // ==========================================

        function renderInstituciones() {
            const grid = document.getElementById('institucionesGrid');
            if (!grid) return;
            
            if (AppState.data.instituciones.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <div class="empty-state-icon">üè´</div>
                        <p>No hay instituciones registradas</p>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = AppState.data.instituciones.map(inst => `
                <div class="section-card">
                    <div class="section-logo">
                        ${inst.logo ? `<img src="${inst.logo}" alt="">` : 'üè´'}
                    </div>
                    <h3 style="text-align: center; margin-bottom: 1rem;">${inst.nombre}</h3>
                    <div style="font-size: 0.9rem; color: #6c757d; margin-bottom: 0.5rem;">
                        <strong>Direcci√≥n Regional:</strong> ${inst.regional}
                    </div>
                    <div style="font-size: 0.9rem; color: #6c757d; margin-bottom: 0.5rem;">
                        <strong>Circuito:</strong> ${inst.circuito}
                    </div>
                    <div style="font-size: 0.9rem; color: #6c757d; margin-bottom: 1rem;">
                        <strong>C√≥digo:</strong> ${inst.codigo}
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn btn-sm btn-primary" style="flex: 1;" onclick="editarInstitucion(${inst.id})">Editar</button>
                        <button class="btn btn-sm btn-danger" style="flex: 1;" onclick="eliminarInstitucion(${inst.id})">Eliminar</button>
                    </div>
                </div>
            `).join('');
        }

        function guardarInstitucion() {
            const inst = {
                id: Date.now(),
                nombre: document.getElementById('instNombre').value,
                regional: document.getElementById('instRegional').value,
                circuito: document.getElementById('instCircuito').value,
                codigo: document.getElementById('instCodigo').value,
                logo: document.getElementById('instLogo').value
            };
            
            if (!inst.nombre || !inst.regional || !inst.circuito || !inst.codigo) {
                showToast('Complete todos los campos obligatorios', 'error');
                return;
            }
            
            AppState.data.instituciones.push(inst);
            saveDataToStorage();
            closeModal('institucionModal');
            renderInstituciones();
            populateSelects();
            showToast('Instituci√≥n guardada correctamente');
        }

        function editarInstitucion(id) {
            const inst = AppState.data.instituciones.find(i => i.id === id);
            if (!inst) return;
            
            document.getElementById('instNombre').value = inst.nombre;
            document.getElementById('instRegional').value = inst.regional;
            document.getElementById('instCircuito').value = inst.circuito;
            document.getElementById('instCodigo').value = inst.codigo;
            document.getElementById('instLogo').value = inst.logo || '';
            
            // Cambiar funci√≥n del bot√≥n para actualizar
            const btn = document.querySelector('#institucionModal .btn-primary');
            btn.onclick = function() {
                inst.nombre = document.getElementById('instNombre').value;
                inst.regional = document.getElementById('instRegional').value;
                inst.circuito = document.getElementById('instCircuito').value;
                inst.codigo = document.getElementById('instCodigo').value;
                inst.logo = document.getElementById('instLogo').value;
                
                saveDataToStorage();
                closeModal('institucionModal');
                renderInstituciones();
                showToast('Instituci√≥n actualizada');
                
                // Restaurar funci√≥n original
                btn.onclick = guardarInstitucion;
            };
            
            openModal('institucionModal');
        }

        function eliminarInstitucion(id) {
            if (!confirm('¬øEliminar esta instituci√≥n? Se eliminar√°n tambi√©n sus secciones y datos asociados.')) return;
            
            AppState.data.instituciones = AppState.data.instituciones.filter(i => i.id !== id);
            // Eliminar secciones asociadas
            AppState.data.secciones = AppState.data.secciones.filter(s => s.institucionId !== id);
            
            saveDataToStorage();
            renderInstituciones();
            showToast('Instituci√≥n eliminada');
        }

        // ==========================================
        // SECCIONES
        // ==========================================

        function renderSecciones() {
            const grid = document.getElementById('seccionesGrid');
            if (!grid) return;
            
            if (AppState.data.secciones.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <div class="empty-state-icon">üë•</div>
                        <p>No hay secciones registradas</p>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = AppState.data.secciones.map(sec => {
                const inst = AppState.data.instituciones.find(i => i.id === sec.institucionId);
                const countEst = AppState.data.estudiantes.filter(e => e.seccionId === sec.id).length;
                
                return `
                    <div class="section-card">
                        <h3 style="font-size: 2.5rem; text-align: center; color: var(--secondary); margin-bottom: 0.5rem;">${sec.nombre}</h3>
                        <div style="text-align: center; color: #6c757d; margin-bottom: 1rem;">
                            ${inst ? inst.nombre : 'Sin instituci√≥n'}<br>
                            A√±o: ${sec.anio} | ${sec.periodos} Per√≠odos
                        </div>
                        <div style="text-align: center; margin-bottom: 1rem;">
                            <span class="badge badge-success">${countEst} estudiantes</span>
                        </div>
                        <button class="btn btn-primary" style="width: 100%; margin-bottom: 0.5rem;" onclick="verEstudiantes(${sec.id})">Ver Estudiantes</button>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-sm btn-secondary" style="flex: 1;" onclick="editarSeccion(${sec.id})">Editar</button>
                            <button class="btn btn-sm btn-danger" style="flex: 1;" onclick="eliminarSeccion(${sec.id})">Eliminar</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function guardarSeccion() {
            const p1 = parseInt(document.getElementById('secP1').value) || 40;
            const p2 = parseInt(document.getElementById('secP2').value) || 60;
            
            if (p1 + p2 !== 100) {
                showToast('La suma de porcentajes debe ser 100%', 'error');
                return;
            }
            
            const sec = {
                id: Date.now(),
                nombre: document.getElementById('secNombre').value,
                institucionId: parseInt(document.getElementById('secInstitucion').value),
                anio: parseInt(document.getElementById('secAnio').value),
                periodos: parseInt(document.getElementById('secPeriodos').value),
                porcentajes: { p1, p2 }
            };
            
            if (!sec.nombre || !sec.institucionId) {
                showToast('Complete todos los campos obligatorios', 'error');
                return;
            }
            
            AppState.data.secciones.push(sec);
            saveDataToStorage();
            closeModal('seccionModal');
            renderSecciones();
            populateSelects();
            showToast('Secci√≥n creada correctamente');
        }

        function verEstudiantes(seccionId) {
            const sec = AppState.data.secciones.find(s => s.id === seccionId);
            const estudiantes = AppState.data.estudiantes.filter(e => e.seccionId === seccionId);
            
            // Crear vista temporal de estudiantes
            const html = `
                <div class="card" id="vistaEstudiantes" style="animation: fadeIn 0.3s;">
                    <div class="card-header">
                        <div>
                            <button class="btn btn-outline btn-sm" onclick="cerrarVistaEstudiantes()" style="margin-bottom: 0.5rem;">
                                ‚Üê Volver a Secciones
                            </button>
                            <h2 class="card-title">Estudiantes de ${sec.nombre}</h2>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-success" onclick="descargarPlantillaExcel(${seccionId})">üì• Plantilla Excel</button>
                            <button class="btn btn-warning" onclick="importarEstudiantes(${seccionId})">üì§ Importar</button>
                            <button class="btn btn-primary" onclick="nuevoEstudiante(${seccionId})">+ Agregar Estudiante</button>
                        </div>
                    </div>
                    
                    ${estudiantes.length === 0 ? `
                        <div class="empty-state">
                            <div class="empty-state-icon">üéì</div>
                            <p>No hay estudiantes registrados</p>
                        </div>
                    ` : `
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>C√©dula</th>
                                        <th>Nombre</th>
                                        <th>Encargado 1</th>
                                        <th>Tel√©fono</th>
                                        <th>Cumplea√±os</th>
                                        <th>ACS</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${estudiantes.map(e => `
                                        <tr>
                                            <td>${e.cedula}</td>
                                            <td>${e.nombre}</td>
                                            <td>${e.encargado1}</td>
                                            <td>
                                                <a href="tel:${e.telefono1}" style="text-decoration: none; margin-right: 0.5rem;">üìû</a>
                                                <a href="https://wa.me/506${e.telefono1?.replace(/\D/g, '')}" target="_blank" style="text-decoration: none;">üí¨</a>
                                                ${e.telefono1}
                                            </td>
                                            <td>${e.nacimiento ? new Date(e.nacimiento).toLocaleDateString('es-ES') : '-'}</td>
                                            <td>${e.adecuacion === 'significativa' ? '<span class="badge badge-warning">ACS</span>' : '-'}</td>
                                            <td>
                                                <button class="btn btn-sm btn-primary" onclick="editarEstudiante(${e.id})">Editar</button>
                                                <button class="btn btn-sm btn-danger" onclick="eliminarEstudiante(${e.id}, ${seccionId})">Eliminar</button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    `}
                </div>
            `;
            
            // Insertar vista
            const seccionesSection = document.getElementById('secciones');
            const existing = document.getElementById('vistaEstudiantes');
            if (existing) existing.remove();
            
            seccionesSection.insertAdjacentHTML('beforeend', html);
            document.getElementById('seccionesGrid').style.display = 'none';
        }

        function cerrarVistaEstudiantes() {
            const vista = document.getElementById('vistaEstudiantes');
            if (vista) vista.remove();
            document.getElementById('seccionesGrid').style.display = 'grid';
        }

        function nuevoEstudiante(seccionId) {
            document.getElementById('estId').value = '';
            document.getElementById('estSeccionId').value = seccionId;
            document.getElementById('estModalTitle').textContent = 'Nuevo Estudiante';
            
            // Limpiar formulario
            document.getElementById('estCedula').value = '';
            document.getElementById('estNombre').value = '';
            document.getElementById('estEnc1').value = '';
            document.getElementById('estTel1').value = '';
            document.getElementById('estEnc2').value = '';
            document.getElementById('estTel2').value = '';
            document.getElementById('estNacimiento').value = '';
            document.getElementById('estEmail').value = '';
            document.getElementById('estAdecuacion').value = 'ninguna';
            
            openModal('estudianteModal');
        }

        function guardarEstudiante() {
            const id = document.getElementById('estId').value;
            const seccionId = parseInt(document.getElementById('estSeccionId').value);
            
            const est = {
                id: id ? parseInt(id) : Date.now(),
                cedula: document.getElementById('estCedula').value,
                nombre: document.getElementById('estNombre').value,
                seccionId: seccionId,
                encargado1: document.getElementById('estEnc1').value,
                telefono1: document.getElementById('estTel1').value,
                encargado2: document.getElementById('estEnc2').value,
                telefono2: document.getElementById('estTel2').value,
                nacimiento: document.getElementById('estNacimiento').value,
                email: document.getElementById('estEmail').value,
                adecuacion: document.getElementById('estAdecuacion').value
            };
            
            if (!est.cedula || !est.nombre || !est.encargado1 || !est.telefono1) {
                showToast('Complete los campos obligatorios', 'error');
                return;
            }
            
            if (id) {
                const idx = AppState.data.estudiantes.findIndex(e => e.id === parseInt(id));
                AppState.data.estudiantes[idx] = est;
            } else {
                AppState.data.estudiantes.push(est);
            }
            
            saveDataToStorage();
            closeModal('estudianteModal');
            showToast('Estudiante guardado correctamente');
            verEstudiantes(seccionId);
        }

        function editarEstudiante(id) {
            const e = AppState.data.estudiantes.find(est => est.id === id);
            if (!e) return;
            
            document.getElementById('estId').value = e.id;
            document.getElementById('estSeccionId').value = e.seccionId;
            document.getElementById('estCedula').value = e.cedula;
            document.getElementById('estNombre').value = e.nombre;
            document.getElementById('estEnc1').value = e.encargado1;
            document.getElementById('estTel1').value = e.telefono1;
            document.getElementById('estEnc2').value = e.encargado2 || '';
            document.getElementById('estTel2').value = e.telefono2 || '';
            document.getElementById('estNacimiento').value = e.nacimiento || '';
            document.getElementById('estEmail').value = e.email || '';
            document.getElementById('estAdecuacion').value = e.adecuacion || 'ninguna';
            document.getElementById('estModalTitle').textContent = 'Editar Estudiante';
            
            openModal('estudianteModal');
        }

        function eliminarEstudiante(id, seccionId) {
            if (!confirm('¬øEliminar este estudiante? Se perder√°n todas sus notas y asistencia.')) return;
            
            AppState.data.estudiantes = AppState.data.estudiantes.filter(e => e.id !== id);
            
            // Limpiar notas del estudiante
            delete AppState.data.notas.tc[id];
            delete AppState.data.notas.tareas[id];
            delete AppState.data.notas.pruebas[id];
            delete AppState.data.notas.proyecto[id];
            delete AppState.data.notas.asistencia[id];
            
            saveDataToStorage();
            showToast('Estudiante eliminado');
            verEstudiantes(seccionId);
        }

        function descargarPlantillaExcel(seccionId) {
            const sec = AppState.data.secciones.find(s => s.id === seccionId);
            const csv = `Cedula,Nombre Completo,Encargado 1,Telefono 1,Encargado 2,Telefono 2,Fecha Nacimiento (YYYY-MM-DD),Correo MEP,Adecuacion (ninguna/significativa/no_significativa)\n`;
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `plantilla_${sec.nombre}.csv`;
            link.click();
            
            showToast('Plantilla descargada');
        }

        function importarEstudiantes(seccionId) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.csv,.xlsx,.xls';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    const text = event.target.result;
                    const lines = text.split('\n').slice(1); // Skip header
                    
                    let count = 0;
                    lines.forEach(line => {
                        const cols = line.split(',');
                        if (cols.length >= 4 && cols[0].trim()) {
                            AppState.data.estudiantes.push({
                                id: Date.now() + Math.random(),
                                cedula: cols[0].trim(),
                                nombre: cols[1].trim(),
                                seccionId: seccionId,
                                encargado1: cols[2].trim(),
                                telefono1: cols[3].trim(),
                                encargado2: cols[4]?.trim() || '',
                                telefono2: cols[5]?.trim() || '',
                                nacimiento: cols[6]?.trim() || '',
                                email: cols[7]?.trim() || '',
                                adecuacion: cols[8]?.trim() || 'ninguna'
                            });
                            count++;
                        }
                    });
                    
                    saveDataToStorage();
                    showToast(`${count} estudiantes importados`);
                    verEstudiantes(seccionId);
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // ==========================================
        // ASIGNATURAS
        // ==========================================

        function renderAsignaturas() {
            const tbody = document.getElementById('asignaturasBody');
            if (!tbody) return;
            
            if (AppState.data.asignaturas.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" style="text-align: center; padding: 2rem;">No hay asignaturas registradas</td></tr>';
                return;
            }
            
            tbody.innerHTML = AppState.data.asignaturas.map(a => {
                const sec = AppState.data.secciones.find(s => s.id === a.seccionId);
                const inst = sec ? AppState.data.instituciones.find(i => i.id === sec.institucionId) : null;
                
                const total = a.tc + a.tareas + a.pruebas + a.asistencia + a.proyecto;
                const validClass = total === 100 ? 'badge-success' : 'badge-danger';
                
                return `
                    <tr>
                        <td><strong>${a.nombre}</strong></td>
                        <td>${sec?.nombre || '-'}</td>
                        <td>${sec?.anio || '-'}</td>
                        <td>${inst?.nombre || '-'}</td>
                        <td>${a.tc}%</td>
                        <td>${a.tareas}%</td>
                        <td>${a.pruebas}%</td>
                        <td>${a.asistencia}%</td>
                        <td>${a.proyecto}% <span class="badge ${validClass}">${total}%</span></td>
                        <td>
                            <button class="btn btn-sm btn-primary" onclick="editarAsignatura(${a.id})">Editar</button>
                            <button class="btn btn-sm btn-danger" onclick="eliminarAsignatura(${a.id})">Eliminar</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function validarPorcentajes() {
            const tc = parseInt(document.getElementById('asigTC').value) || 0;
            const tareas = parseInt(document.getElementById('asigTareas').value) || 0;
            const pruebas = parseInt(document.getElementById('asigPruebas').value) || 0;
            const asistencia = parseInt(document.getElementById('asigAsistencia').value) || 0;
            const proyecto = parseInt(document.getElementById('asigProyecto').value) || 0;
            
            const total = tc + tareas + pruebas + asistencia + proyecto;
            const warning = document.getElementById('porcentajeWarning');
            const btn = document.getElementById('btnGuardarAsignatura');
            
            if (total !== 100) {
                warning.style.display = 'block';
                warning.textContent = `‚ö†Ô∏è La suma es ${total}%. Debe ser exactamente 100%`;
                btn.disabled = true;
            } else {
                warning.style.display = 'none';
                btn.disabled = false;
            }
        }

        function guardarAsignatura() {
            const tc = parseInt(document.getElementById('asigTC').value) || 0;
            const tareas = parseInt(document.getElementById('asigTareas').value) || 0;
            const pruebas = parseInt(document.getElementById('asigPruebas').value) || 0;
            const asistencia = parseInt(document.getElementById('asigAsistencia').value) || 0;
            const proyecto = parseInt(document.getElementById('asigProyecto').value) || 0;
            
            if (tc + tareas + pruebas + asistencia + proyecto !== 100) {
                showToast('La suma de porcentajes debe ser 100%', 'error');
                return;
            }
            
            const asig = {
                id: Date.now(),
                nombre: document.getElementById('asigNombre').value,
                seccionId: parseInt(document.getElementById('asigSeccion').value),
                tc, tareas, pruebas, asistencia, proyecto,
                notaMinima: parseInt(document.getElementById('asigMinima').value) || 65
            };
            
            if (!asig.nombre || !asig.seccionId) {
                showToast('Complete los campos obligatorios', 'error');
                return;
            }
            
            AppState.data.asignaturas.push(asig);
            saveDataToStorage();
            closeModal('asignaturaModal');
            renderAsignaturas();
            populateSelects();
            showToast('Asignatura creada correctamente');
        }

        function editarAsignatura(id) {
            const a = AppState.data.asignaturas.find(as => as.id === id);
            if (!a) return;
            
            document.getElementById('asigNombre').value = a.nombre;
            document.getElementById('asigSeccion').value = a.seccionId;
            document.getElementById('asigTC').value = a.tc;
            document.getElementById('asigTareas').value = a.tareas;
            document.getElementById('asigPruebas').value = a.pruebas;
            document.getElementById('asigAsistencia').value = a.asistencia;
            document.getElementById('asigProyecto').value = a.proyecto;
            document.getElementById('asigMinima').value = a.notaMinima || 65;
            
            const btn = document.getElementById('btnGuardarAsignatura');
            btn.textContent = 'Actualizar Asignatura';
            btn.onclick = function() {
                a.nombre = document.getElementById('asigNombre').value;
                a.seccionId = parseInt(document.getElementById('asigSeccion').value);
                a.tc = parseInt(document.getElementById('asigTC').value) || 0;
                a.tareas = parseInt(document.getElementById('asigTareas').value) || 0;
                a.pruebas = parseInt(document.getElementById('asigPruebas').value) || 0;
                a.asistencia = parseInt(document.getElementById('asigAsistencia').value) || 0;
                a.proyecto = parseInt(document.getElementById('asigProyecto').value) || 0;
                a.notaMinima = parseInt(document.getElementById('asigMinima').value) || 65;
                
                saveDataToStorage();
                closeModal('asignaturaModal');
                renderAsignaturas();
                showToast('Asignatura actualizada');
                
                btn.textContent = 'Guardar Asignatura';
                btn.onclick = guardarAsignatura;
            };
            
            validarPorcentajes();
            openModal('asignaturaModal');
        }

        function eliminarAsignatura(id) {
            if (!confirm('¬øEliminar esta asignatura? Se perder√°n todos los datos asociados.')) return;
            
            AppState.data.asignaturas = AppState.data.asignaturas.filter(a => a.id !== id);
            saveDataToStorage();
            renderAsignaturas();
            showToast('Asignatura eliminada');
        }

        // ==========================================
        // HORARIO
        // ==========================================

        function renderScheduleGrid() {
            const maxLecciones = parseInt(document.getElementById('maxLecciones').value) || 7;
            const grid = document.getElementById('scheduleGrid');
            const dias = ['', 'Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes'];
            
            let html = '';
            
            // Headers
            dias.forEach(dia => {
                html += `<div class="schedule-cell header">${dia || 'Lecci√≥n'}</div>`;
            });
            
            // Grid
            for (let leccion = 1; leccion <= maxLecciones; leccion++) {
                html += `<div class="schedule-cell time-header">Lecci√≥n ${leccion}</div>`;
                
                for (let dia = 1; dia <= 5; dia++) {
                    const horarioItem = AppState.data.horario.find(h => h.dia === dia && h.leccion === leccion);
                    
                    if (horarioItem) {
                        const asig = AppState.data.asignaturas.find(a => a.id === horarioItem.asignaturaId);
                        const sec = asig ? AppState.data.secciones.find(s => s.id === asig.seccionId) : null;
                        
                        html += `
                            <div class="schedule-cell">
                                <div class="schedule-lesson" style="background: ${horarioItem.color || 'var(--secondary)'};">
                                    <div style="font-weight: 600;">${asig?.nombre?.substring(0, 20) || 'Clase'}</div>
                                    <div style="font-size: 0.75rem; opacity: 0.9;">${sec?.nombre || ''}</div>
                                </div>
                                <button class="btn btn-sm btn-danger" style="margin-top: 0.5rem; width: 100%;" onclick="eliminarHorario(${dia}, ${leccion})">Eliminar</button>
                            </div>
                        `;
                    } else {
                        html += `
                            <div class="schedule-cell">
                                <select class="schedule-select" onchange="asignarHorario(${dia}, ${leccion}, this.value)">
                                    <option value="">-- Seleccionar --</option>
                                    ${AppState.data.asignaturas.map(a => {
                                        const sec = AppState.data.secciones.find(s => s.id === a.seccionId);
                                        return `<option value="${a.id}">${a.nombre} (${sec?.nombre})</option>`;
                                    }).join('')}
                                </select>
                            </div>
                        `;
                    }
                }
            }
            
            grid.innerHTML = html;
        }

        function updateScheduleGrid() {
            renderScheduleGrid();
        }

        function asignarHorario(dia, leccion, asignaturaId) {
            if (!asignaturaId) return;
            
            const colors = ['#2a9d8f', '#e9c46a', '#e76f51', '#f4a261', '#264653', '#2b2d42', '#8d99ae', '#57c5b6', '#159895'];
            const color = colors[Math.floor(Math.random() * colors.length)];
            
            AppState.data.horario.push({
                id: Date.now(),
                dia,
                leccion,
                asignaturaId: parseInt(asignaturaId),
                color
            });
            
            saveDataToStorage();
            renderScheduleGrid();
            showToast('Horario actualizado');
        }

        function eliminarHorario(dia, leccion) {
            AppState.data.horario = AppState.data.horario.filter(h => !(h.dia === dia && h.leccion === leccion));
            saveDataToStorage();
            renderScheduleGrid();
            showToast('Lecci√≥n eliminada del horario');
        }

        function saveSchedule() {
            saveDataToStorage();
            showToast('Horario guardado correctamente');
        }

        // ==========================================
        // ASISTENCIA
        // ==========================================

        function initAsistencia() {
            // Poblar selects
            const selSeccion = document.getElementById('attendanceSeccion');
            if (selSeccion) {
                selSeccion.innerHTML = '<option value="">Todas las secciones</option>' +
                    AppState.data.secciones.map(s => `<option value="${s.id}">${s.nombre}</option>`).join('');
            }
            
            // Fecha por defecto hoy
            const fechaInput = document.getElementById('attendanceDate');
            if (fechaInput && !fechaInput.value) {
                fechaInput.value = new Date().toISOString().split('T')[0];
            }
            
            renderAttendanceCalendar();
            loadAttendanceLessons();
        }

        function renderAttendanceCalendar() {
            const container = document.getElementById('attendanceCalendar');
            if (!container) return;
            
            const hoy = new Date();
            const diasSemana = ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'];
            
            let html = '';
            for (let i = -3; i <= 10; i++) {
                const fecha = new Date(hoy);
                fecha.setDate(fecha.getDate() + i);
                
                const fechaStr = fecha.toISOString().split('T')[0];
                const tieneAsistencia = AppState.data.asistencia.some(a => a.fecha === fechaStr);
                const esHoy = i === 0;
                
                let clase = 'calendar-day';
                if (esHoy) clase += ' active';
                else if (tieneAsistencia) clase += ' has-attendance';
                else if (fecha.getDay() === 0 || fecha.getDay() === 6) clase += ' missing';
                
                html += `
                    <div class="${clase}" onclick="selectAttendanceDate('${fechaStr}')">
                        <div class="calendar-day-name">${diasSemana[fecha.getDay()]}</div>
                        <div class="calendar-day-number">${fecha.getDate()}</div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }

        function selectAttendanceDate(fecha) {
            document.getElementById('attendanceDate').value = fecha;
            loadAttendanceLessons();
        }

        function loadAttendanceLessons() {
            const seccionId = document.getElementById('attendanceSeccion')?.value;
            const fecha = document.getElementById('attendanceDate')?.value;
            const container = document.getElementById('attendanceLessons');
            
            if (!container || !fecha) return;
            
            // Obtener lecciones del horario para esa fecha
            const diaSemana = new Date(fecha).getDay(); // 0=Dom, 1=Lun...
            const leccionesHorario = AppState.data.horario.filter(h => {
                if (h.dia !== diaSemana) return false;
                if (seccionId && h.seccionId && h.seccionId !== parseInt(seccionId)) return false;
                return true;
            });
            
            // Si no hay horario configurado, mostrar lecciones gen√©ricas
            const lecciones = leccionesHorario.length > 0 ? leccionesHorario : 
                Array.from({length: 7}, (_, i) => ({
                    leccion: i + 1,
                    asignaturaId: null,
                    disponible: true
                }));
            
            container.innerHTML = lecciones.map((l, idx) => {
                const asig = l.asignaturaId ? AppState.data.asignaturas.find(a => a.id === l.asignaturaId) : null;
                const sec = asig ? AppState.data.secciones.find(s => s.id === asig.seccionId) : null;
                
                // Verificar si ya tiene asistencia registrada
                const tieneRegistro = AppState.data.asistencia.some(a => 
                    a.fecha === fecha && a.leccion === (l.leccion || idx + 1)
                );
                
                const clase = tieneRegistro ? 'registered' : 'available';
                
                return `
                    <div class="lesson-card ${clase}" onclick="openAttendanceForm(${l.leccion || idx + 1}, ${asig?.id || 'null'})">
                        <div class="lesson-number">Lecci√≥n ${l.leccion || idx + 1}</div>
                        <div class="lesson-subject">${asig?.nombre || 'Sin asignar'}</div>
                        <div class="lesson-section">${sec?.nombre || ''}</div>
                        ${tieneRegistro ? '<div style="margin-top: 0.5rem; font-size: 0.8rem;">‚úì Asistencia registrada</div>' : ''}
                        <div class="lesson-actions" onclick="event.stopPropagation()">
                            ${tieneRegistro ? `
                                <button class="lesson-btn lesson-btn-edit" onclick="editarAsistencia('${fecha}', ${l.leccion || idx + 1})">Editar</button>
                                <button class="lesson-btn lesson-btn-delete" onclick="eliminarAsistencia('${fecha}', ${l.leccion || idx + 1})">Eliminar</button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
            
            // Ocultar formulario de asistencia
            document.getElementById('attendanceForm').style.display = 'none';
        }

        function openAttendanceForm(leccion, asignaturaId) {
            const fecha = document.getElementById('attendanceDate').value;
            const seccionId = document.getElementById('attendanceSeccion').value;
            
            // Determinar estudiantes a mostrar
            let estudiantes = [];
            if (seccionId) {
                estudiantes = AppState.data.estudiantes.filter(e => e.seccionId === parseInt(seccionId));
            } else if (asignaturaId) {
                const asig = AppState.data.asignaturas.find(a => a.id === asignaturaId);
                if (asig) {
                    estudiantes = AppState.data.estudiantes.filter(e => e.seccionId === asig.seccionId);
                }
            } else {
                // Mostrar todos los estudiantes si no hay filtro
                estudiantes = AppState.data.estudiantes;
            }
            
            if (estudiantes.length === 0) {
                showToast('No hay estudiantes para esta selecci√≥n', 'error');
                return;
            }
            
            // Verificar si ya existe registro para editar
            const asistenciaExistente = AppState.data.asistencia.filter(a => 
                a.fecha === fecha && a.leccion === leccion
            );
            
            document.getElementById('attendanceLessonTitle').textContent = `Lecci√≥n ${leccion} - ${fecha}`;
            document.getElementById('attendanceForm').style.display = 'block';
            
            const listContainer = document.getElementById('attendanceList');
            listContainer.innerHTML = estudiantes.map(e => {
                // Buscar estado existente
                const existente = asistenciaExistente.find(a => a.estudianteId === e.id);
                const estado = existente ? existente.estado : 'presente';
                
                return `
                    <div class="attendance-item" data-estudiante-id="${e.id}">
                        <div class="attendance-student">
                            <div class="student-avatar">${e.nombre.charAt(0)}</div>
                            <div>
                                <strong>${e.nombre}</strong>
                                <div style="font-size: 0.85rem; color: #6c757d;">${e.cedula}</div>
                            </div>
                        </div>
                        <div class="attendance-status">
                            <button class="status-btn ${estado === 'presente' ? 'active present' : ''}" onclick="setEstado(this, 'presente')">Presente</button>
                            <button class="status-btn ${estado === 'ausente_j' ? 'active absent-j' : ''}" onclick="setEstado(this, 'ausente_j')">A.Just</button>
                            <button class="status-btn ${estado === 'ausente_i' ? 'active absent-i' : ''}" onclick="setEstado(this, 'ausente_i')">A.Injust</button>
                            <button class="status-btn ${estado === 'tarde' ? 'active late' : ''}" onclick="setEstado(this, 'tarde')">Tarde</button>
                        </div>
                    </div>
                `;
            }).join('');
            
            // Scroll al formulario
            document.getElementById('attendanceForm').scrollIntoView({ behavior: 'smooth' });
        }

        function setEstado(btn, estado) {
            const buttons = btn.parentElement.querySelectorAll('.status-btn');
            buttons.forEach(b => b.classList.remove('active', 'present', 'absent-j', 'absent-i', 'late'));
            
            btn.classList.add('active', estado);
        }

        function saveAttendance() {
            const fecha = document.getElementById('attendanceDate').value;
            const leccion = parseInt(document.getElementById('attendanceLessonTitle').textContent.match(/\d+/)[0]);
            const asignaturaId = document.querySelector('.lesson-card.selected')?.dataset.asignaturaId || null;
            
            const items = document.querySelectorAll('#attendanceList .attendance-item');
            let guardados = 0;
            
            items.forEach(item => {
                const estudianteId = parseInt(item.dataset.estudianteId);
                const estadoBtn = item.querySelector('.status-btn.active');
                const estado = estadoBtn ? estadoBtn.textContent.toLowerCase().includes('presente') ? 'presente' :
                    estadoBtn.textContent.includes('just') ? 'ausente_j' :
                    estadoBtn.textContent.includes('injust') ? 'ausente_i' : 'tarde' : 'presente';
                
                // Eliminar registro existente
                AppState.data.asistencia = AppState.data.asistencia.filter(a => 
                    !(a.fecha === fecha && a.leccion === leccion && a.estudianteId === estudianteId)
                );
                
                AppState.data.asistencia.push({
                    id: Date.now() + Math.random(),
                    fecha,
                    leccion,
                    estudianteId,
                    asignaturaId: asignaturaId ? parseInt(asignaturaId) : null,
                    estado
                });
                
                guardados++;
            });
            
            saveDataToStorage();
            showToast(`${guardados} registros de asistencia guardados`);
            
            document.getElementById('attendanceForm').style.display = 'none';
            loadAttendanceLessons();
            renderAttendanceCalendar();
        }

        function cancelAttendance() {
            document.getElementById('attendanceForm').style.display = 'none';
        }

        function editarAsistencia(fecha, leccion) {
            openAttendanceForm(leccion, null);
        }

        function eliminarAsistencia(fecha, leccion) {
            if (!confirm('¬øEliminar el registro de asistencia de esta lecci√≥n?')) return;
            
            AppState.data.asistencia = AppState.data.asistencia.filter(a => 
                !(a.fecha === fecha && a.leccion === leccion)
            );
            
            saveDataToStorage();
            loadAttendanceLessons();
            renderAttendanceCalendar();
            showToast('Registro de asistencia eliminado');
        }

        // ==========================================
        // EVALUACIONES - TRABAJO COTIDIANO
        // ==========================================

        function initEvaluaciones() {
            populateEvalSelects();
            loadTrabajoCotidiano();
        }

        function populateEvalSelects() {
            const asigs = AppState.data.asignaturas.map(a => {
                const sec = AppState.data.secciones.find(s => s.id === a.seccionId);
                return `<option value="${a.id}">${a.nombre} - ${sec?.nombre}</option>`;
            }).join('');
            
            ['tcAsignatura', 'tareaAsignatura', 'pruebaAsignatura', 'proyectoAsignatura'].forEach(id => {
                const sel = document.getElementById(id);
                if (sel) {
                    sel.innerHTML = '<option value="">Seleccionar asignatura...</option>' + asigs;
                }
            });
        }

        function loadTrabajoCotidiano() {
            const asigId = document.getElementById('tcAsignatura')?.value;
            if (!asigId) {
                document.getElementById('tcTableRegular').innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìù</div><p>Seleccione una asignatura</p></div>';
                return;
            }
            
            const asig = AppState.data.asignaturas.find(a => a.id === parseInt(asigId));
            const estudiantes = AppState.data.estudiantes.filter(e => e.seccionId === asig.seccionId);
            
            // Indicadores regulares
            const indicadores = AppState.data.indicadores.filter(i => 
                i.asignaturaId === parseInt(asigId) && i.acs !== 'si'
            );
            
            // Mostrar configuraci√≥n de indicadores
            const configDiv = document.getElementById('indicadoresConfig');
            configDiv.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h4 style="color: var(--primary);">Indicadores Configurados</h4>
                    <span class="badge badge-info">${indicadores.length} indicadores</span>
                </div>
                ${indicadores.length === 0 ? '<p style="color: #6c757d;">No hay indicadores. Agregue indicadores para evaluar.</p>' : 
                    indicadores.map(i => `
                        <div class="indicator-item">
                            <div>
                                <div class="indicator-name">${i.descripcion}</div>
                                <div class="indicator-points">${i.puntos} puntos - ${i.fecha ? new Date(i.fecha).toLocaleDateString() : 'Sin fecha'}</div>
                            </div>
                            <button class="btn btn-sm btn-danger" onclick="eliminarIndicador(${i.id})">Eliminar</button>
                        </div>
                    `).join('')
                }
            `;
            
            // Tabla de evaluaci√≥n
            const container = document.getElementById('tcTableRegular');
            if (indicadores.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìä</div><p>Agregue indicadores para comenzar a evaluar</p></div>';
                return;
            }
            
            // Crear tabla con estudiantes e indicadores
            let html = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Estudiante</th>
                                ${indicadores.map(i => `<th title="${i.descripcion}">${i.descripcion.substring(0, 15)}...</th>`).join('')}
                                <th>% Obtenido</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${estudiantes.filter(e => e.adecuacion !== 'significativa').map(e => {
                                const notasEst = AppState.data.notas.tc[e.id] || {};
                                let totalPuntos = 0;
                                let maxPuntos = 0;
                                
                                return `
                                    <tr>
                                        <td><strong>${e.nombre}</strong></td>
                                        ${indicadores.map(i => {
                                            maxPuntos += i.puntos;
                                            const nota = notasEst[i.id] || 0;
                                            totalPuntos += parseInt(nota) || 0;
                                            return `
                                                <td>
                                                    <input type="number" 
                                                        class="score-input ${notasEst[i.id] ? 'saved' : ''}" 
                                                        value="${nota || ''}" 
                                                        min="0" 
                                                        max="${i.puntos}"
                                                        onchange="guardarNotaTC(${e.id}, ${i.id}, this.value, ${i.puntos}, this)"
                                                        title="M√°ximo: ${i.puntos} puntos"
                                                    >
                                                </td>
                                            `;
                                        }).join('')}
                                        <td>
                                            <strong>${maxPuntos > 0 ? ((totalPuntos / maxPuntos) * 100).toFixed(1) : 0}%</strong>
                                            <div class="progress-container">
                                                <div class="progress-bar" style="width: ${maxPuntos > 0 ? (totalPuntos / maxPuntos) * 100 : 0}%">
                                                    ${totalPuntos}/${maxPuntos}
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            container.innerHTML = html;
            
            // Cargar tabla ACS
            loadTC_ACS(asigId, indicadores);
        }

        function loadTC_ACS(asigId, indicadoresRegulares) {
            const asig = AppState.data.asignaturas.find(a => a.id === parseInt(asigId));
            const estudiantesACS = AppState.data.estudiantes.filter(e => 
                e.seccionId === asig.seccionId && e.adecuacion === 'significativa'
            );
            
            const indicadoresACS = AppState.data.indicadores.filter(i => 
                i.asignaturaId === parseInt(asigId) && i.acs === 'si'
            );
            
            const container = document.getElementById('tcTableACS');
            
            if (estudiantesACS.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">‚ôø</div><p>No hay estudiantes con ACS en esta secci√≥n</p></div>';
                return;
            }
            
            // Similar a la tabla regular pero con indicadores ACS
            let html = `
                <div style="margin-bottom: 1rem;">
                    <span class="badge badge-warning">Estudiantes con Adecuaci√≥n Curricular Significativa</span>
                </div>
            `;
            
            if (indicadoresACS.length === 0) {
                html += '<div class="empty-state"><div class="empty-state-icon">üìù</div><p>Agregue indicadores espec√≠ficos para ACS</p></div>';
            } else {
                html += `
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Estudiante (ACS)</th>
                                    ${indicadoresACS.map(i => `<th>${i.descripcion.substring(0, 15)}...</th>`).join('')}
                                    <th>% Obtenido</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${estudiantesACS.map(e => {
                                    const notasEst = AppState.data.notas.tc[e.id] || {};
                                    let totalPuntos = 0;
                                    let maxPuntos = 0;
                                    
                                    return `
                                        <tr>
                                            <td><strong>${e.nombre}</strong></td>
                                            ${indicadoresACS.map(i => {
                                                maxPuntos += i.puntos;
                                                const nota = notasEst[i.id] || 0;
                                                totalPuntos += parseInt(nota) || 0;
                                                return `
                                                    <td>
                                                        <input type="number" 
                                                            class="score-input ${notasEst[i.id] ? 'saved' : ''}" 
                                                            value="${nota || ''}" 
                                                            min="0" 
                                                            max="${i.puntos}"
                                                            onchange="guardarNotaTC(${e.id}, ${i.id}, this.value, ${i.puntos}, this)"
                                                        >
                                                    </td>
                                                `;
                                            }).join('')}
                                            <td>
                                                <strong>${maxPuntos > 0 ? ((totalPuntos / maxPuntos) * 100).toFixed(1) : 0}%</strong>
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }

        function guardarNotaTC(estudianteId, indicadorId, valor, maxPuntos, input) {
            valor = parseInt(valor) || 0;
            if (valor < 0) valor = 0;
            if (valor > maxPuntos) {
                valor = maxPuntos;
                input.value = maxPuntos;
                showToast(`M√°ximo ${maxPuntos} puntos`, 'warning');
            }
            
            if (!AppState.data.notas.tc[estudianteId]) {
                AppState.data.notas.tc[estudianteId] = {};
            }
            
            AppState.data.notas.tc[estudianteId][indicadorId] = valor;
            saveDataToStorage();
            
            input.classList.add('saved');
            showToast('Nota guardada autom√°ticamente');
            
            // Recalcular porcentaje
            loadTrabajoCotidiano();
        }

        function guardarIndicador() {
            const ind = {
                id: Date.now(),
                asignaturaId: parseInt(document.getElementById('tcAsignatura').value),
                descripcion: document.getElementById('indDescripcion').value,
                fecha: document.getElementById('indFecha').value,
                puntos: parseInt(document.getElementById('indPuntos').value) || 3,
                acs: document.getElementById('indACS').value
            };
            
            if (!ind.asignaturaId || !ind.descripcion) {
                showToast('Complete los campos obligatorios', 'error');
                return;
            }
            
            AppState.data.indicadores.push(ind);
            saveDataToStorage();
            closeModal('indicadorModal');
            
            // Limpiar formulario
            document.getElementById('indDescripcion').value = '';
            document.getElementById('indFecha').value = '';
            document.getElementById('indPuntos').value = '3';
            document.getElementById('indContador').textContent = '0';
            
            loadTrabajoCotidiano();
            showToast('Indicador agregado correctamente');
        }

        function guardarIndicadorSimultaneo() {
            const descripcion = document.getElementById('indSimDescripcion').value;
            const puntos = parseInt(document.getElementById('indSimPuntos').value) || 3;
            
            // Obtener asignaturas seleccionadas
            const checkboxes = document.querySelectorAll('#indSimAsignaturas input[type="checkbox"]:checked');
            const asignaturasIds = Array.from(checkboxes).map(cb => parseInt(cb.value));
            
            if (!descripcion || asignaturasIds.length === 0) {
                showToast('Seleccione al menos una asignatura y complete la descripci√≥n', 'error');
                return;
            }
            
            asignaturasIds.forEach(asigId => {
                AppState.data.indicadores.push({
                    id: Date.now() + Math.random(),
                    asignaturaId: asigId,
                    descripcion,
                    fecha: new Date().toISOString().split('T')[0],
                    puntos,
                    acs: 'no'
                });
            });
            
            saveDataToStorage();
            closeModal('indicadorSimultaneoModal');
            loadTrabajoCotidiano();
            showToast(`Indicador agregado a ${asignaturasIds.length} asignaturas`);
        }

        function eliminarIndicador(id) {
            if (!confirm('¬øEliminar este indicador? Se perder√°n las notas asociadas.')) return;
            
            AppState.data.indicadores = AppState.data.indicadores.filter(i => i.id !== id);
            
            // Limpiar notas de este indicador
            Object.keys(AppState.data.notas.tc).forEach(estId => {
                delete AppState.data.notas.tc[estId][id];
            });
            
            saveDataToStorage();
            loadTrabajoCotidiano();
            showToast('Indicador eliminado');
        }

        // ==========================================
        // EVALUACIONES - TAREAS
        // ==========================================

        function loadTareas() {
            const asigId = document.getElementById('tareaAsignatura')?.value;
            if (!asigId) {
                document.getElementById('tareasTableRegular').innerHTML = '<div class="empty-state"><p>Seleccione una asignatura</p></div>';
                return;
            }
            
            const asig = AppState.data.asignaturas.find(a => a.id === parseInt(asigId));
            const estudiantes = AppState.data.estudiantes.filter(e => e.seccionId === asig.seccionId);
            
            // Tareas regulares
            const tareas = AppState.data.tareas.filter(t => 
                t.asignaturaId === parseInt(asigId) && t.acs !== 'si'
            );
            
            // Configuraci√≥n de tareas
            const configDiv = document.getElementById('tareasConfig');
            configDiv.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h4 style="color: var(--primary);">Tareas Configuradas</h4>
                    <div>
                        <span class="badge badge-info">${tareas.length} tareas</span>
                        <span class="badge ${calcularTotalPorcentajeTareas(asigId) > asig.tareas ? 'badge-danger' : 'badge-success'}">
                            Total: ${calcularTotalPorcentajeTareas(asigId).toFixed(1)}% / ${asig.tareas}%
                        </span>
                    </div>
                </div>
                ${tareas.length === 0 ? '<p style="color: #6c757d;">No hay tareas configuradas.</p>' :
                    tareas.map(t => `
                        <div class="indicator-item">
                            <div>
                                <div class="indicator-name">${t.nombre}</div>
                                <div class="indicator-points">${t.puntos} pts - ${t.porcentaje}% del componente - Entrega: ${t.fecha || 'Sin fecha'}</div>
                            </div>
                            <button class="btn btn-sm btn-danger" onclick="eliminarTarea(${t.id})">Eliminar</button>
                        </div>
                    `).join('')
                }
            `;
            
            // Tabla de evaluaci√≥n
            const container = document.getElementById('tareasTableRegular');
            if (tareas.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìù</div><p>Agregue tareas para comenzar a evaluar</p></div>';
                return;
            }
            
            let html = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Estudiante</th>
                                ${tareas.map(t => `<th>${t.nombre}<br><small>(${t.puntos}pts, ${t.porcentaje}%)</small></th>`).join('')}
                                <th>% Obtenido<br><small>(del ${asig.tareas}%)</small></th>
                            </tr>
                        </thead>
                        <tbody>
                            ${estudiantes.filter(e => e.adecuacion !== 'significativa').map(e => {
                                const notasEst = AppState.data.notas.tareas[e.id] || {};
                                let porcentajeTotal = 0;
                                
                                return `
                                    <tr>
                                        <td><strong>${e.nombre}</strong></td>
                                        ${tareas.map(t => {
                                            const nota = notasEst[t.id] || '';
                                            const porcentaje = nota ? ((nota / t.puntos) * t.porcentaje) : 0;
                                            porcentajeTotal += porcentaje;
                                            return `
                                                <td>
                                                    <input type="number" 
                                                        class="score-input ${notasEst[t.id] !== undefined ? 'saved' : ''}" 
                                                        value="${nota}" 
                                                        min="0" 
                                                        max="${t.puntos}"
                                                        step="0.01"
                                                        onchange="guardarNotaTarea(${e.id}, ${t.id}, this.value, ${t.puntos}, ${t.porcentaje}, this)"
                                                    >
                                                </td>
                                            `;
                                        }).join('')}
                                        <td>
                                            <strong>${porcentajeTotal.toFixed(2)}%</strong>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            container.innerHTML = html;
            
            // Cargar tabla ACS
            loadTareasACS(asigId, tareas);
        }

        function loadTareasACS(asigId, tareasRegulares) {
            const asig = AppState.data.asignaturas.find(a => a.id === parseInt(asigId));
            const estudiantesACS = AppState.data.estudiantes.filter(e => 
                e.seccionId === asig.seccionId && e.adecuacion === 'significativa'
            );
            
            const tareasACS = AppState.data.tareas.filter(t => 
                t.asignaturaId === parseInt(asigId) && t.acs === 'si'
            );
            
            const container = document.getElementById('tareasTableACS');
            
            if (estudiantesACS.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">‚ôø</div><p>No hay estudiantes con ACS</p></div>';
                return;
            }
            
            let html = `
                <div style="margin-bottom: 1rem;">
                    <span class="badge badge-warning">Estudiantes con ACS</span>
                </div>
            `;
            
            if (tareasACS.length === 0) {
                html += '<div class="empty-state"><p>Agregue tareas espec√≠ficas para ACS</p></div>';
            } else {
                html += `
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Estudiante (ACS)</th>
                                    ${tareasACS.map(t => `<th>${t.nombre}</th>`).join('')}
                                    <th>% Obtenido</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${estudiantesACS.map(e => {
                                    const notasEst = AppState.data.notas.tareas[e.id] || {};
                                    let porcentajeTotal = 0;
                                    
                                    return `
                                        <tr>
                                            <td><strong>${e.nombre}</strong></td>
                                            ${tareasACS.map(t => {
                                                const nota = notasEst[t.id] || '';
                                                const porcentaje = nota ? ((nota / t.puntos) * t.porcentaje) : 0;
                                                porcentajeTotal += porcentaje;
                                                return `
                                                    <td>
                                                        <input type="number" 
                                                            class="score-input" 
                                                            value="${nota}" 
                                                            min="0" 
                                                            max="${t.puntos}"
                                                            onchange="guardarNotaTarea(${e.id}, ${t.id}, this.value, ${t.puntos}, ${t.porcentaje}, this)"
                                                        >
                                                    </td>
                                                `;
                                            }).join('')}
                                            <td><strong>${porcentajeTotal.toFixed(2)}%</strong></td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }

        function calcularTotalPorcentajeTareas(asigId) {
            return AppState.data.tareas
                .filter(t => t.asignaturaId === parseInt(asigId) && t.acs !== 'si')
                .reduce((sum, t) => sum + parseFloat(t.porcentaje), 0);
        }

        function guardarTarea() {
            const asigId = parseInt(document.getElementById('tareaAsignatura').value);
            const porcentaje = parseFloat(document.getElementById('tareaPorcentaje').value) || 0;
            
            // Validar que no exceda el porcentaje del componente
            const asig = AppState.data.asignaturas.find(a => a.id === asigId);
            const totalActual = calcularTotalPorcentajeTareas(asigId);
            
            if (totalActual + porcentaje > asig.tareas) {
                showToast(`Error: El total (${totalActual + porcentaje}%) excede el ${asig.tareas}% del componente`, 'error');
                return;
            }
            
            const tarea = {
                id: Date.now(),
                asignaturaId: asigId,
                nombre: document.getElementById('tareaNombre').value,
                puntos: parseInt(document.getElementById('tareaPuntos').value) || 20,
                porcentaje: porcentaje,
                fecha: document.getElementById('tareaFecha').value,
                acs: document.getElementById('tareaACS').value
            };
            
            if (!tarea.nombre || !tarea.asignaturaId) {
                showToast('Complete los campos obligatorios', 'error');
                return;
            }
            
            AppState.data.tareas.push(tarea);
            saveDataToStorage();
            closeModal('tareaModal');
            
            // Limpiar formulario
            document.getElementById('tareaNombre').value = '';
            document.getElementById('tareaPuntos').value = '20';
            document.getElementById('tareaPorcentaje').value = '5';
            document.getElementById('tareaFecha').value = '';
            
            loadTareas();
            showToast('Tarea agregada correctamente');
        }

        function guardarNotaTarea(estudianteId, tareaId, valor, maxPuntos, porcentaje, input) {
            valor = parseFloat(valor) || 0;
            if (valor < 0) valor = 0;
            if (valor > maxPuntos) {
                valor = maxPuntos;
                input.value = maxPuntos;
            }
            
            if (!AppState.data.notas.tareas[estudianteId]) {
                AppState.data.notas.tareas[estudianteId] = {};
            }
            
            AppState.data.notas.tareas[estudianteId][tareaId] = valor;
            saveDataToStorage();
            
            input.classList.add('saved');
            showToast('Nota guardada');
            
            // Recalcular
            loadTareas();
        }

        function eliminarTarea(id) {
            if (!confirm('¬øEliminar esta tarea?')) return;
            
            AppState.data.tareas = AppState.data.tareas.filter(t => t.id !== id);
            saveDataToStorage();
            loadTareas();
            showToast('Tarea eliminada');
        }

        // ==========================================
        // EVALUACIONES - PRUEBAS
        // ==========================================

        function loadPruebas() {
            const asigId = document.getElementById('pruebaAsignatura')?.value;
            if (!asigId) {
                document.getElementById('pruebasTableRegular').innerHTML = '<div class="empty-state"><p>Seleccione una asignatura</p></div>';
                return;
            }
            
            const asig = AppState.data.asignaturas.find(a => a.id === parseInt(asigId));
            const estudiantes = AppState.data.estudiantes.filter(e => e.seccionId === asig.seccionId);
            
            const pruebas = AppState.data.pruebas.filter(p => 
                p.asignaturaId === parseInt(asigId) && p.acs !== 'si'
            );
            
            // Configuraci√≥n
            const configDiv = document.getElementById('pruebasConfig');
            configDiv.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h4 style="color: var(--primary);">Pruebas Configuradas</h4>
                    <div>
                        <span class="badge badge-info">${pruebas.length} pruebas</span>
                        <span class="badge ${calcularTotalPorcentajePruebas(asigId) > asig.pruebas ? 'badge-danger' : 'badge-success'}">
                            Total: ${calcularTotalPorcentajePruebas(asigId).toFixed(1)}% / ${asig.pruebas}%
                        </span>
                    </div>
                </div>
                ${pruebas.length === 0 ? '<p style="color: #6c757d;">No hay pruebas configuradas.</p>' :
                    pruebas.map(p => `
                        <div class="indicator-item">
                            <div>
                                <div class="indicator-name">${p.nombre}</div>
                                <div class="indicator-points">${p.puntos} pts - ${p.porcentaje}% - ${p.fecha ? new Date(p.fecha).toLocaleDateString() : 'Sin fecha'}</div>
                            </div>
                            <button class="btn btn-sm btn-danger" onclick="eliminarPrueba(${p.id})">Eliminar</button>
                        </div>
                    `).join('')
                }
            `;
            
            // Tabla
            const container = document.getElementById('pruebasTableRegular');
            if (pruebas.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìù</div><p>Agregue pruebas para evaluar</p></div>';
                return;
            }
            
            container.innerHTML = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Estudiante</th>
                                ${pruebas.map(p => `<th>${p.nombre}<br><small>(${p.puntos}pts, ${p.porcentaje}%)</small></th>`).join('')}
                                <th>% Obtenido<br><small>(del ${asig.pruebas}%)</small></th>
                            </tr>
                        </thead>
                        <tbody>
                            ${estudiantes.filter(e => e.adecuacion !== 'significativa').map(e => {
                                const notasEst = AppState.data.notas.pruebas[e.id] || {};
                                let porcentajeTotal = 0;
                                
                                return `
                                    <tr>
                                        <td><strong>${e.nombre}</strong></td>
                                        ${pruebas.map(p => {
                                            const nota = notasEst[p.id] || '';
                                            const porcentaje = nota ? ((nota / p.puntos) * p.porcentaje) : 0;
                                            porcentajeTotal += porcentaje;
                                            return `
                                                <td>
                                                    <input type="number" 
                                                        class="score-input ${notasEst[p.id] !== undefined ? 'saved' : ''}" 
                                                        value="${nota}" 
                                                        min="0" 
                                                        max="${p.puntos}"
                                                        step="0.01"
                                                        onchange="guardarNotaPrueba(${e.id}, ${p.id}, this.value, ${p.puntos}, ${p.porcentaje}, this)"
                                                    >
                                                </td>
                                            `;
                                        }).join('')}
                                        <td><strong>${porcentajeTotal.toFixed(2)}%</strong></td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            // ACS
            loadPruebasACS(asigId, pruebas);
        }

        function loadPruebasACS(asigId, pruebasRegulares) {
            const asig = AppState.data.asignaturas.find(a => a.id === parseInt(asigId));
            const estudiantesACS = AppState.data.estudiantes.filter(e => 
                e.seccionId === asig.seccionId && e.adecuacion === 'significativa'
            );
            
            const pruebasACS = AppState.data.pruebas.filter(p => 
                p.asignaturaId === parseInt(asigId) && p.acs === 'si'
            );
            
            const container = document.getElementById('pruebasTableACS');
            
            if (estudiantesACS.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">‚ôø</div><p>No hay estudiantes con ACS</p></div>';
                return;
            }
            
            let html = `
                <div style="margin-bottom: 1rem;">
                    <span class="badge badge-warning">Estudiantes con ACS</span>
                </div>
            `;
            
            if (pruebasACS.length === 0) {
                html += '<div class="empty-state"><p>Agregue pruebas espec√≠ficas para ACS</p></div>';
            } else {
                html += `
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Estudiante (ACS)</th>
                                    ${pruebasACS.map(p => `<th>${p.nombre}</th>`).join('')}
                                    <th>% Obtenido</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${estudiantesACS.map(e => {
                                    const notasEst = AppState.data.notas.pruebas[e.id] || {};
                                    let porcentajeTotal = 0;
                                    
                                    return `
                                        <tr>
                                            <td><strong>${e.nombre}</strong></td>
                                            ${pruebasACS.map(p => {
                                                const nota = notasEst[p.id] || '';
                                                const porcentaje = nota ? ((nota / p.puntos) * p.porcentaje) : 0;
                                                porcentajeTotal += porcentaje;
                                                return `
                                                    <td>
                                                        <input type="number" 
                                                            class="score-input" 
                                                            value="${nota}" 
                                                            min="0" 
                                                            max="${p.puntos}"
                                                            onchange="guardarNotaPrueba(${e.id}, ${p.id}, this.value, ${p.puntos}, ${p.porcentaje}, this)"
                                                        >
                                                    </td>
                                                `;
                                            }).join('')}
                                            <td><strong>${porcentajeTotal.toFixed(2)}%</strong></td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }

        function calcularTotalPorcentajePruebas(asigId) {
            return AppState.data.pruebas
                .filter(p => p.asignaturaId === parseInt(asigId) && p.acs !== 'si')
                .reduce((sum, p) => sum + parseFloat(p.porcentaje), 0);
        }

        function guardarPrueba() {
            const asigId = parseInt(document.getElementById('pruebaAsignatura').value);
            const porcentaje = parseFloat(document.getElementById('pruebaPorcentaje').value) || 0;
            
            const asig = AppState.data.asignaturas.find(a => a.id === asigId);
            const totalActual = calcularTotalPorcentajePruebas(asigId);
            
            if (totalActual + porcentaje > asig.pruebas) {
                showToast(`Error: El total excede el ${asig.pruebas}% del componente`, 'error');
                return;
            }
            
            const prueba = {
                id: Date.now(),
                asignaturaId: asigId,
                nombre: document.getElementById('pruebaNombre').value,
                puntos: parseInt(document.getElementById('pruebaPuntos').value) || 100,
                porcentaje: porcentaje,
                fecha: document.getElementById('pruebaFecha').value,
                acs: document.getElementById('pruebaACS').value
            };
            
            if (!prueba.nombre || !prueba.fecha) {
                showToast('Complete los campos obligatorios', 'error');
                return;
            }
            
            AppState.data.pruebas.push(prueba);
            saveDataToStorage();
            closeModal('pruebaModal');
            
            // Limpiar
            document.getElementById('pruebaNombre').value = '';
            document.getElementById('pruebaPuntos').value = '100';
            document.getElementById('pruebaPorcentaje').value = '15';
            document.getElementById('pruebaFecha').value = '';
            
            loadPruebas();
            showToast('Prueba agregada correctamente');
        }

        function guardarNotaPrueba(estudianteId, pruebaId, valor, maxPuntos, porcentaje, input) {
            valor = parseFloat(valor) || 0;
            if (valor < 0) valor = 0;
            if (valor > maxPuntos) {
                valor = maxPuntos;
                input.value = maxPuntos;
            }
            
            if (!AppState.data.notas.pruebas[estudianteId]) {
                AppState.data.notas.pruebas[estudianteId] = {};
            }
            
            AppState.data.notas.pruebas[estudianteId][pruebaId] = valor;
            saveDataToStorage();
            
            input.classList.add('saved');
            showToast('Nota guardada');
            loadPruebas();
        }

        function eliminarPrueba(id) {
            if (!confirm('¬øEliminar esta prueba?')) return;
            
            AppState.data.pruebas = AppState.data.pruebas.filter(p => p.id !== id);
            saveDataToStorage();
            loadPruebas();
            showToast('Prueba eliminada');
        }

        // ==========================================
        // EVALUACIONES - PROYECTO
        // ==========================================

        function loadProyecto() {
            const asigId = document.getElementById('proyectoAsignatura')?.value;
            const container = document.getElementById('proyectoContent');
            
            if (!container) return;
            
            if (!asigId) {
                container.innerHTML = '<div class="empty-state"><p>Seleccione una asignatura</p></div>';
                return;
            }
            
            const asig = AppState.data.asignaturas.find(a => a.id === parseInt(asigId));
            
            if (asig.proyecto === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <p>Esta asignatura no tiene componente de proyecto configurado</p>
                        <p style="color: #6c757d; margin-top: 0.5rem;">El porcentaje de proyecto es 0%</p>
                    </div>
                `;
                return;
            }
            
            const estudiantes = AppState.data.estudiantes.filter(e => e.seccionId === asig.seccionId);
            
            container.innerHTML = `
                <div class="card">
                    <div style="margin-bottom: 1.5rem;">
                        <h4 style="color: var(--primary);">Evaluaci√≥n de Proyecto</h4>
                        <p style="color: #6c757d;">Este componente representa el ${asig.proyecto}% de la nota final</p>
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Estudiante</th>
                                    <th>Nota Proyecto (0-100)</th>
                                    <th>% en Nota Final<br><small>(${asig.proyecto}% del total)</small></th>
                                </tr>
                            </thead>
                            <tbody>
                                ${estudiantes.map(e => {
                                    const nota = AppState.data.notas.proyecto[e.id] || '';
                                    const porcentajeFinal = nota ? ((nota / 100) * asig.proyecto).toFixed(2) : '0.00';
                                    
                                    return `
                                        <tr>
                                            <td><strong>${e.nombre}</strong></td>
                                            <td>
                                                <input type="number" 
                                                    class="score-input ${nota !== '' ? 'saved' : ''}" 
                                                    value="${nota}" 
                                                    min="0" 
                                                    max="100"
                                                    onchange="guardarNotaProyecto(${e.id}, this.value, ${asig.proyecto}, this)"
                                                >
                                            </td>
                                            <td><strong>${porcentajeFinal}%</strong></td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        function guardarNotaProyecto(estudianteId, valor, porcentajeAsig, input) {
            valor = parseFloat(valor) || 0;
            if (valor < 0) valor = 0;
            if (valor > 100) {
                valor = 100;
                input.value = 100;
            }
            
            AppState.data.notas.proyecto[estudianteId] = valor;
            saveDataToStorage();
            
            input.classList.add('saved');
            showToast('Nota de proyecto guardada');
            loadProyecto();
        }

        // ==========================================
        // BIT√ÅCORAS
        // ==========================================

        function renderBitacoras() {
            const asigFiltro = document.getElementById('bitacoraFiltroAsignatura')?.value || '';
            const searchText = document.getElementById('bitacoraSearch')?.value?.toLowerCase() || '';
            
            // Poblar filtro de asignaturas
            const selFiltro = document.getElementById('bitacoraFiltroAsignatura');
            if (selFiltro && selFiltro.options.length <= 1) {
                selFiltro.innerHTML = '<option value="">Todas las asignaturas</option>' +
                    AppState.data.asignaturas.map(a => `<option value="${a.id}">${a.nombre}</option>`).join('');
            }
            
            // Filtrar bit√°coras
            let bitacoras = [...AppState.data.bitacoras].sort((a, b) => new Date(b.fecha) - new Date(a.fecha));
            
            if (asigFiltro) {
                bitacoras = bitacoras.filter(b => b.asignaturaId === parseInt(asigFiltro));
            }
            
            if (searchText) {
                bitacoras = bitacoras.filter(b => 
                    (b.contenido && b.contenido.toLowerCase().includes(searchText)) ||
                    (b.tema && b.tema.toLowerCase().includes(searchText))
                );
            }
            
            const container = document.getElementById('bitacoraList');
            
            if (bitacoras.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìñ</div>
                        <p>No hay registros en la bit√°cora</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = bitacoras.map(b => {
                const asig = AppState.data.asignaturas.find(a => a.id === b.asignaturaId);
                const fecha = new Date(b.fecha).toLocaleDateString('es-ES', {
                    weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
                });
                
                return `
                    <div class="card" style="margin-bottom: 1rem; border-left: 4px solid var(--secondary);">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                            <div>
                                <span class="badge badge-success">${asig?.nombre || 'General'}</span>
                                <div style="font-size: 0.9rem; color: #6c757d; margin-top: 0.5rem;">
                                    üìÖ ${fecha}
                                    ${b.recordatorio ? `<br>üîî Recordatorio: ${new Date(b.recordatorio).toLocaleDateString('es-ES')}` : ''}
                                </div>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn btn-sm btn-primary" onclick="editarBitacora(${b.id})">Editar</button>
                                <button class="btn btn-sm btn-danger" onclick="eliminarBitacora(${b.id})">Eliminar</button>
                            </div>
                        </div>
                        
                        ${b.tema ? `<div style="margin-bottom: 0.5rem;"><strong>Tema:</strong> ${b.tema}</div>` : ''}
                        ${b.objetivo ? `<div style="margin-bottom: 0.5rem;"><strong>Objetivo:</strong> ${b.objetivo}</div>` : ''}
                        ${b.actividades ? `<div style="margin-bottom: 0.5rem;"><strong>Actividades:</strong> ${b.actividades}</div>` : ''}
                        ${b.recursos ? `<div style="margin-bottom: 0.5rem;"><strong>Recursos:</strong> ${b.recursos}</div>` : ''}
                        ${b.observaciones ? `<div style="margin-bottom: 0.5rem;"><strong>Observaciones:</strong> ${b.observaciones}</div>` : ''}
                        
                        ${b.contenido ? `
                            <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border);">
                                <p style="white-space: pre-wrap;">${b.contenido}</p>
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function guardarBitacora() {
            const bit = {
                id: Date.now(),
                asignaturaId: parseInt(document.getElementById('bitAsignatura').value),
                fecha: document.getElementById('bitFecha').value,
                tema: document.getElementById('bitTema').value,
                objetivo: document.getElementById('bitObjetivo').value,
                actividades: document.getElementById('bitActividades').value,
                recursos: document.getElementById('bitRecursos').value,
                observaciones: document.getElementById('bitObservaciones').value,
                contenido: document.getElementById('bitContenido').value,
                recordatorio: document.getElementById('bitRecordatorio').value || null
            };
            
            if (!bit.asignaturaId || !bit.fecha) {
                showToast('Seleccione asignatura y fecha', 'error');
                return;
            }
            
            AppState.data.bitacoras.push(bit);
            saveDataToStorage();
            closeModal('bitacoraModal');
            
            // Limpiar formulario
            document.getElementById('bitTema').value = '';
            document.getElementById('bitObjetivo').value = '';
            document.getElementById('bitActividades').value = '';
            document.getElementById('bitRecursos').value = '';
            document.getElementById('bitObservaciones').value = '';
            document.getElementById('bitContenido').value = '';
            document.getElementById('bitRecordatorio').value = '';
            document.getElementById('bitContador').textContent = '0';
            
            renderBitacoras();
            updateNotifications();
            showToast('Bit√°cora guardada');
        }

        function editarBitacora(id) {
            const b = AppState.data.bitacoras.find(bit => bit.id === id);
            if (!b) return;
            
            document.getElementById('bitAsignatura').value = b.asignaturaId;
            document.getElementById('bitFecha').value = b.fecha;
            document.getElementById('bitTema').value = b.tema || '';
            document.getElementById('bitObjetivo').value = b.objetivo || '';
            document.getElementById('bitActividades').value = b.actividades || '';
            document.getElementById('bitRecursos').value = b.recursos || '';
            document.getElementById('bitObservaciones').value = b.observaciones || '';
            document.getElementById('bitContenido').value = b.contenido || '';
            document.getElementById('bitRecordatorio').value = b.recordatorio || '';
            
            // Cambiar funci√≥n del bot√≥n
            const btn = document.querySelector('#bitacoraModal .btn-primary');
            btn.textContent = 'Actualizar Bit√°cora';
            btn.onclick = function() {
                b.asignaturaId = parseInt(document.getElementById('bitAsignatura').value);
                b.fecha = document.getElementById('bitFecha').value;
                b.tema = document.getElementById('bitTema').value;
                b.objetivo = document.getElementById('bitObjetivo').value;
                b.actividades = document.getElementById('bitActividades').value;
                b.recursos = document.getElementById('bitRecursos').value;
                b.observaciones = document.getElementById('bitObservaciones').value;
                b.contenido = document.getElementById('bitContenido').value;
                b.recordatorio = document.getElementById('bitRecordatorio').value || null;
                
                saveDataToStorage();
                closeModal('bitacoraModal');
                renderBitacoras();
                updateNotifications();
                showToast('Bit√°cora actualizada');
                
                btn.textContent = 'Guardar Bit√°cora';
                btn.onclick = guardarBitacora;
            };
            
            openModal('bitacoraModal');
        }

        function eliminarBitacora(id) {
            if (!confirm('¬øEliminar esta entrada de la bit√°cora?')) return;
            
            AppState.data.bitacoras = AppState.data.bitacoras.filter(b => b.id !== id);
            saveDataToStorage();
            renderBitacoras();
            updateNotifications();
            showToast('Bit√°cora eliminada');
        }

        function exportarBitacoraWord() {
            const bitacoras = AppState.data.bitacoras.sort((a, b) => new Date(b.fecha) - new Date(a.fecha));
            
            let html = `
                <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word'>
                <head><meta charset='utf-8'><title>Bit√°cora</title></head>
                <body>
                    <h1>Bit√°cora de Clase - Idonet 2.0</h1>
                    <p>Generado: ${new Date().toLocaleString('es-ES')}</p>
                    <hr>
            `;
            
            bitacoras.forEach(b => {
                const asig = AppState.data.asignaturas.find(a => a.id === b.asignaturaId);
                html += `
                    <div style="margin-bottom: 2rem; page-break-inside: avoid;">
                        <h3>${asig?.nombre || 'General'} - ${new Date(b.fecha).toLocaleDateString('es-ES')}</h3>
                        ${b.tema ? `<p><strong>Tema:</strong> ${b.tema}</p>` : ''}
                        ${b.objetivo ? `<p><strong>Objetivo:</strong> ${b.objetivo}</p>` : ''}
                        ${b.actividades ? `<p><strong>Actividades:</strong> ${b.actividades}</p>` : ''}
                        ${b.recursos ? `<p><strong>Recursos:</strong> ${b.recursos}</p>` : ''}
                        ${b.observaciones ? `<p><strong>Observaciones:</strong> ${b.observaciones}</p>` : ''}
                        ${b.contenido ? `<p>${b.contenido.replace(/\n/g, '<br>')}</p>` : ''}
                        <hr>
                    </div>
                `;
            });
            
            html += '</body></html>';
            
            const blob = new Blob([html], { type: 'application/msword' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `bitacora_${new Date().toISOString().split('T')[0]}.doc`;
            link.click();
            
            showToast('Bit√°cora exportada a Word');
        }
        // ==========================================
        // REPORTES
        // ==========================================

        function generarReporte() {
            const tipo = document.getElementById('reporteTipo').value;
            const preview = document.getElementById('reportPreview');
            
            // Simulaci√≥n de reporte
            const inst = data.instituciones[0] || { nombre: 'Instituci√≥n' };
            const fecha = new Date().toLocaleDateString('es-ES');
            
            let contenido = '';
            
            if (tipo === 'asistencia') {
                contenido = generarReporteAsistencia();
            } else {
                contenido = generarReporteNotas(tipo);
            }

            preview.innerHTML = `
                <div class="report-header">
                    <div class="report-logo">üìö</div>
                    <h2>MINISTERIO DE EDUCACI√ìN P√öBLICA</h2>
                    <h3>${inst.nombre}</h3>
                    <p>Direcci√≥n Regional: ${inst.regional || 'N/A'} | Circuito: ${inst.circuito || 'N/A'}</p>
                    <hr style="margin: 1rem 0;">
                    <h2>${tipo === 'asistencia' ? 'REPORTE DE ASISTENCIA' : 'REPORTE DE CALIFICACIONES'}</h2>
                    <p>Fecha: ${fecha}</p>
                </div>
                ${contenido}
            `;
        }

        function generarReporteAsistencia() {
            const estudiantes = data.estudiantes.slice(0, 5); // Demo con primeros 5
            return `
                <table style="width: 100%; border-collapse: collapse; margin-top: 2rem;">
                    <thead>
                        <tr style="background: #163333; color: white;">
                            <th style="padding: 0.75rem; border: 1px solid #ddd;">Estudiante</th>
                            <th style="padding: 0.75rem; border: 1px solid #ddd;">Lecciones Presentes</th>
                            <th style="padding: 0.75rem; border: 1px solid #ddd;">Ausencias Just.</th>
                            <th style="padding: 0.75rem; border: 1px solid #ddd;">Ausencias Injust.</th>
                            <th style="padding: 0.75rem; border: 1px solid #ddd;">Tardanzas</th>
                            <th style="padding: 0.75rem; border: 1px solid #ddd;">% Asistencia</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${estudiantes.map(e => {
                            const asist = data.asistencia.filter(a => a.estudianteId === e.id);
                            const presentes = asist.filter(a => a.estado === 'presente').length;
                            const aj = asist.filter(a => a.estado === 'ausente_j').length;
                            const ai = asist.filter(a => a.estado === 'ausente_i').length;
                            const tard = asist.filter(a => a.estado === 'tarde').length;
                            const total = asist.length || 1;
                            const pct = ((presentes / total) * 100).toFixed(1);
                            return `
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid #ddd;">${e.nombre}</td>
                                    <td style="padding: 0.75rem; border: 1px solid #ddd; text-align: center;">${presentes}</td>
                                    <td style="padding: 0.75rem; border: 1px solid #ddd; text-align: center;">${aj}</td>
                                    <td style="padding: 0.75rem; border: 1px solid #ddd; text-align: center;">${ai}</td>
                                    <td style="padding: 0.75rem; border: 1px solid #ddd; text-align: center;">${tard}</td>
                                    <td style="padding: 0.75rem; border: 1px solid #ddd; text-align: center; font-weight: bold;">${pct}%</td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
                <div style="margin-top: 2rem; text-align: right;">
                    <p><strong>Docente:</strong> ${data.configuracion.docente.nombre || '_____________________'}</p>
                    <p style="margin-top: 2rem;">_____________________</p>
                    <p>Firma</p>
                </div>
            `;
        }

        function generarReporteNotas(tipo) {
            return `
                <div style="margin-top: 2rem;">
                    <h3>I Per√≠odo</h3>
                    <table style="width: 100%; border-collapse: collapse; margin-top: 1rem;">
                        <thead>
                            <tr style="background: #163333; color: white;">
                                <th style="padding: 0.75rem; border: 1px solid #ddd;">Estudiante</th>
                                <th style="padding: 0.75rem; border: 1px solid #ddd;">T.Cotidiano (50%)</th>
                                <th style="padding: 0.75rem; border: 1px solid #ddd;">Tareas (10%)</th>
                                <th style="padding: 0.75rem; border: 1px solid #ddd;">Pruebas (30%)</th>
                                <th style="padding: 0.75rem; border: 1px solid #ddd;">Asistencia (10%)</th>
                                <th style="padding: 0.75rem; border: 1px solid #ddd;">Nota Final</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.estudiantes.slice(0, 5).map(e => `
                                <tr>
                                    <td style="padding: 0.75rem; border: 1px solid #ddd;">${e.nombre}</td>
                                    <td style="padding: 0.75rem; border: 1px solid #ddd; text-align: center;">${(Math.random() * 10 + 40).toFixed(0)}</td>
                                    <td style="padding: 0.75rem; border: 1px solid #ddd; text-align: center;">${(Math.random() * 2 + 8).toFixed(1)}</td>
                                    <td style="padding: 0.75rem; border: 1px solid #ddd; text-align: center;">${(Math.random() * 20 + 20).toFixed(0)}</td>
                                    <td style="padding: 0.75rem; border: 1px solid #ddd; text-align: center;">${(Math.random() * 2 + 8).toFixed(1)}</td>
                                    <td style="padding: 0.75rem; border: 1px solid #ddd; text-align: center; font-weight: bold;">${(Math.random() * 20 + 75).toFixed(0)}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        function exportarPDF() {
            window.print();
        }

        function exportarWord() {
            const content = document.getElementById('reportPreview').innerHTML;
            const blob = new Blob([`
                <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word'>
                <head><meta charset='utf-8'><title>Reporte</title></head>
                <body>${content}</body>
                </html>
            `], { type: 'application/msword' });
            
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'reporte.doc';
            a.click();
        }

        function exportarExcel() {
            // Simulaci√≥n simple de CSV
            let csv = 'Estudiante,Nota1,Nota2,Nota3\n';
            data.estudiantes.forEach(e => {
                csv += `${e.nombre},${Math.random()*100},${Math.random()*100},${Math.random()*100}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'reporte.csv';
            a.click();
        }

        // ==========================================
        // CONFIGURACI√ìN Y UTILIDADES
        // ==========================================

        function guardarConfiguracion() {
            data.configuracion.docente.nombre = document.getElementById('docenteNombre').value;
            data.configuracion.docente.email = document.getElementById('docenteEmail').value;
            saveData();
            showToast('Configuraci√≥n guardada');
        }

        function exportarDatos() {
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `idonet_backup_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            showToast('Backup exportado correctamente');
        }

        function importarDatos(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    data = imported;
                    saveData();
                    renderAll();
                    showToast('Datos importados correctamente');
                } catch (err) {
                    showToast('Error al importar archivo', 'error');
                }
            };
            reader.readAsText(file);
        }

        // ==========================================
        // HELPERS
        // ==========================================

        function populateSelects() {
            // Poblar selects de instituciones
            const instSelects = document.querySelectorAll('#secInstitucion, #reporteInstitucion');
            instSelects.forEach(sel => {
                if (sel) sel.innerHTML = data.instituciones.map(i => `<option value="${i.id}">${i.nombre}</option>`).join('');
            });

            // Poblar selects de secciones
            const secSelects = document.querySelectorAll('#asigSeccion, #reporteSeccion, #bitAsignatura');
            secSelects.forEach(sel => {
                if (sel) sel.innerHTML = '<option value="">Seleccionar...</option>' + 
                    data.secciones.map(s => `<option value="${s.id}">${s.nombre}</option>`).join('');
            });
        }

        function getAsignaturaName(id) {
            const a = data.asignaturas.find(as => as.id === id);
            return a ? a.nombre : 'General';
        }

        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type === 'error' ? 'error' : ''}`;
            toast.innerHTML = `
                <span>${type === 'error' ? '‚ùå' : '‚úÖ'}</span>
                <span>${message}</span>
            `;
            container.appendChild(toast);
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        function renderAll() {
            renderInstituciones();
            renderSecciones();
            renderAsignaturas();
            renderBitacoras();
            updateDashboard();
        }

        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            document.getElementById('bitFecha').value = new Date().toISOString().split('T')[0];
        });

        // Cerrar modales al hacer clic fuera
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.classList.remove('active');
            }
        }

        // Service Worker para PWA (offline)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:text/javascript,' + encodeURIComponent(`
                self.addEventListener('install', e => e.waitUntil(self.skipWaiting()));
                self.addEventListener('activate', e => e.waitUntil(self.clients.claim()));
                self.addEventListener('fetch', e => e.respondWith(fetch(e.request).catch(() => caches.match(e.request))));
            `)).catch(() => console.log('SW no registrado'));
        }
    </script>
</body>
</html>
